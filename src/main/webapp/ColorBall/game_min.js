(function(){FZ={newClass:function(e,b){if(e===undefined){e={};}var c=function(){};if(typeof b==="function"&&b.hasOwnProperty("prototype")){c.prototype=b.prototype;}else{if(typeof b==="object"){c.prototype=b;}}var d=function(){};if(e.hasOwnProperty("init")||"init" in c.prototype){d=function(){this.init.apply(this,arguments);};}d.prototype=new c();d.prototype.constructor=d;for(var a in e){d.prototype[a]=e[a];}return d;},$:function(a){return document.getElementById(a);},Tools:{splat:function(a){if(!a){return[];}if(a instanceof Array||(typeof a==="object"&&typeof a.length==="number"&&a.callee)){return a;}else{return[a];}},bind:function(c,b,a){return function(){return b.apply(c,FZ.Tools.splat(a));};},bindWithEvent:function(c,b,a){return function(e){var d=[e];Array.prototype.push.apply(d,FZ.Tools.splat(a));return b.apply(c,d);};},trim:function(a){return a.replace(/^\s+|\s+$/g,"");},extend:function(b,a){for(var c in a){b[c]=a[c];}}},EngineOptions:{DebugLevel:"error"},_trace:function(a){if(FZ.EngineOptions.DebugLevel==="info"){console.log(a);}},_assert:function(b,a){if((FZ.EngineOptions.DebugLevel==="error"||FZ.EngineOptions.DebugLevel==="info")&&(!b)){alert(a);}}};})();(function(){FZ.ResourceManager={__ResourceCount:0,__ResourceLoaded:0,__GeneralCallback:null,__GeneralCallbackObj:null,ResourceLib:{},isResourceLoaded:function(){return this.__ResourceCount===this.__ResourceLoaded;},addResource:function(c){if(this.ResourceFactory.hasOwnProperty(c.Type)){this.__ResourceCount++;var b={Resource:null,Loaded:false};this.ResourceLib[c.Name]=b;FZ._trace("Add/load resource["+c.Name+"] : "+c.URL);var a=new this.ResourceFactory[c.Type](c.URL,b);a.setCallback(function(){b.Loaded=true;FZ.ResourceManager.__ResourceLoaded++;if(c.callback){c.callback(b.Resource);}if(FZ.ResourceManager.__GeneralCallback){FZ.ResourceManager.__GeneralCallback.call();}});a.load();}else{Throw("Error: Do not suppport Resourcetype:"+c.Type);}},setCallback:function(a){this.__GeneralCallback=a;},getLoadingRatio:function(){if(this.__ResourceCount===0){return 1;}return this.__ResourceLoaded/this.__ResourceCount;},ResourceFactory:{},registerResourceType:function(b,a){this.ResourceFactory[b]=a;},getResource:function(a){return this.ResourceLib[a].Resource;}};FZ.Class_Resource={callback:function(){},init:function(a,b){this.URL=a;this.target=b;},setCallback:function(a){this.callback=a;}};})();(function(){var a=FZ.newClass({load:function(){var b=new Audio();b.src=this.URL;b.load();b.play();b.pause();this.callback();this.target.Resource=b;}},FZ.Class_Resource);FZ.ResourceManager.registerResourceType("Audio",a);})();(function(){var a=FZ.newClass({load:function(){this.target.Resource=document.createElement("script");this.target.Resource.addEventListener("load",this.callback,false);this.target.Resource.src=this.URL;document.body.appendChild(this.target.Resource);}},FZ.Class_Resource);FZ.ResourceManager.registerResourceType("Js",a);})();(function(){var a=FZ.newClass({load:function(){this.target.Resource=new Image();this.target.Resource.addEventListener("load",this.callback,false);this.target.Resource.addEventListener("error",function(){alert(this.URL);},false);this.target.Resource.src=this.URL;}},FZ.Class_Resource);FZ.ResourceManager.registerResourceType("Image",a);})();(function(){FZ.stateStatus={};FZ.stateStatus.INIT=0;FZ.stateStatus.NORMAL=5;FZ.stateStatus.HIDENOTIFY=15;FZ.stateStatus.HIDELOGIC=20;FZ.stateStatus.DONOTHING=30;FZ.GameStateBase=FZ.newClass({StateName:"GameStateBase",m_status:FZ.stateStatus.NORMAL,init:function(){FZ.GameBase.registerState(this.StateName,this);},pause:function(){this.m_status=FZ.stateStatus.HIDENOTIFY;},resume:function(){this.m_status=FZ.stateStatus.NORMAL;},preProcess:function(){},postProcess:function(){},AIUpdate:function(a){},visualUpdate:function(){}});FZ.GameBase={Time:(new Date()).getTime(),FrameNum:0,Fps:0,Fps_lastTime:0,Fps_lastFrame:0,DefaultFPS:30,CurrentState:null,__StateLib:{},__stateStack:[],Width:640,Height:480,MainCanvas:null,MainContext:null,Name:"",SaveObject:{},init:function(a){this.MainCanvas=document.createElement("canvas");this.MainCanvas.width=this.Width;this.MainCanvas.height=this.Height;this.MainContext=this.MainCanvas.getContext("2d");this.MainCanvas.addEventListener("mousemove",FZ.Tools.bindWithEvent(FZ.ControlManager,FZ.ControlManager.MouseMove),false);this.MainCanvas.addEventListener("mousedown",FZ.Tools.bindWithEvent(FZ.ControlManager,FZ.ControlManager.MouseDown),false);this.MainCanvas.addEventListener("mouseup",FZ.Tools.bindWithEvent(FZ.ControlManager,FZ.ControlManager.MouseUp),false);this.theInterval=setInterval(FZ.Tools.bind(this,this.update),1000/this.DefaultFPS);a.appendChild(this.MainCanvas);},update:function(){var d=0;var b=null;this.FrameNum++;var c=(new Date()).getTime();var a=(c-this.Time)/1000;this.Time=c;if(this.time-this.Fps_lastTime>1000){this.Fps=Math.round(10*(this.FrameNum-this.Fps_lastFrame)/((this.Time-this.Fps_lastTime)/1000))/10;this.Fps_lastTime=this.Time;this.Fps_lastFrame=this.FrameNum;}for(d=0;d<this.__stateStack.length;d++){b=this.__stateStack[d];if((b)&&(b!==this.CurrentState)){if(FZ.stateStatus.NORMAL===b.m_status){b.AIUpdate(a);b.visualUpdate();}else{if(FZ.stateStatus.HIDENOTIFY===b.m_status){b.visualUpdate();}else{if(FZ.stateStatus.HIDELOGIC===b.m_status){b.AIUpdate(a);}else{if(FZ.stateStatus.DONOTHING===b.m_status){}}}}}}if(null!==this.CurrentState){this.CurrentState.AIUpdate(a);this.CurrentState.visualUpdate();}},saveGame:function(){FZ._assert(this.Name!="","Please set the name of the game first");localStorage.removeItem("FZ.Game."+this.Name);localStorage.setItem("FZ.Game."+this.Name,FZ.JSON.stringify(this.SaveObject));},loadGame:function(){FZ._assert(this.Name!="","Please set the name of the game first");if(this.Name==""){return false;}if(!localStorage.hasOwnProperty("FZ.Game."+this.Name)){this.SaveObject={};return false;}this.SaveObject=FZ.JSON.parse(localStorage["FZ.Game."+this.Name]);return true;},registerState:function(a,b){this.__StateLib[a]=b;},getState:function(a){return this.__StateLib[a];},switchToState:function(d){var b=this.CurrentState;var c=this.CurrentState.StateName;var a=[c];Array.prototype.push.apply(a,arguments);this.CurrentState=this.__StateLib[d];this.CurrentState.preProcess.apply(this.CurrentState,a);b.postProcess();},resetAllState:function(){var a=0;a=this.__stateStack.length;this.__stateStack.splice(0,a);},pushState:function(a){this.__stateStack.push(this.__StateLib[a]);},popState:function(){this.CurrentState=this.__stateStack.pop();if((undefined!==this.CurrentState)&&(null!==this.CurrentState)){if(this.CurrentState.resume){this.CurrentState.resume.apply(this.CurrentState,arguments);}}}};FZ.GameBase.CurrentState=new FZ.GameStateBase();})();(function(){FZ.Sprite=FZ.newClass({__currentIdx:0,__currentFrameTime:0,__matrixDirty:true,__inverseMatrixDirty:true,init:function(c,b){this.__theImages=[];this.__children=[];this.__localMatrix=new FZ.Math.Matrix3();this.__worldMatrix=new FZ.Math.Matrix3();this.__inverseMatrix=new FZ.Math.Matrix3();this.__parentSprite=undefined;this.__playing=Boolean(b);if(!c||c.length===0){this.__currentIdx=-1;return;}for(var a=0,d=c.length;a<d;++a){if(c[a] instanceof Array){this.__theImages.push([c[a][0],c[a][1]?c[a][1]:0.033]);}else{this.__theImages.push([c[a],0.033]);}}},clone:function(){var c=new FZ.Sprite();c.__theImages=this.__theImages;c.__localMatrix=this.__localMatrix.clone();c.__currentIdx=this.__theImages.length===0?-1:0;for(var b=0,a=this.__children.length;b<a;++b){c.addChild(this.__children[b].clone());}return c;},setFrameTime:function(c){if(typeof c==="number"){for(var b=0,a=this.__theImages.length;b<a;++b){this.__theImages[b][1]=c;}}else{for(var b=0;b<c.length&&b<__theImages.length;++b){this.__theImages[b][1]=c[b];}}},addChild:function(a){this.__children.push(a);a.__parentSprite=this;},update:function(b){if(!this.__playing){return;}for(var c=0,a=this.__children.length;c<a;++c){this.__children[c].update(b);}if(this.__currentIdx===-1){return;}this.__currentFrameTime+=b;while(this.__currentFrameTime>this.__theImages[this.__currentIdx][1]){this.__currentFrameTime-=this.__theImages[this.__currentIdx][1];this.__currentIdx++;if(this.__currentIdx===this.__theImages.length){this.__currentIdx=0;}}},setFrame:function(a){this.__currentIdx=FZ.Math.clamp(a,0,this.__theImages.length-1);},stop:function(){this.__playing=false;},play:function(){this.__playing=true;},getPosition:function(){this.__DirtyMatrixProcess();var a=new FZ.Math.Vector2(0,0);return a.applyTransform(this.__worldMatrix,a);},localToWorld:function(a){this.__DirtyMatrixProcess();return a.applyTransform(this.__worldMatrix);},worldToLocal:function(a){this.__DirtyInverseMatrixProcess();return a.applyTransform(this.__inverseMatrix);},__markMatrixDirty:function(){if(!this.__matrixDirty){this.__matrixDirty=true;this.__inverseMatrixDirty=true;for(var b=0,a=this.__children.length;b<a;++b){this.__children[b].__markMatrixDirty();}}},__DirtyInverseMatrixProcess:function(){this.__DirtyMatrixProcess();if(this.__inverseMatrixDirty){this.__worldMatrix.inverseAffine(this.__inverseMatrix);this.__inverseMatrixDirty=false;}},__DirtyMatrixProcess:function(){if(this.__matrixDirty){if(this.__parentSprite){this.__parentSprite.__worldMatrix.mul(this.__localMatrix,this.__worldMatrix);}else{this.__worldMatrix=this.__localMatrix;}this.__matrixDirty=false;}},draw:function(b){this.__DirtyMatrixProcess();for(var c=0,a=this.__children.length;c<a;++c){this.__children[c].draw(b);}if(this.__currentIdx===-1){return;}b.setTransform(this.__worldMatrix.m11,this.__worldMatrix.m12,this.__worldMatrix.m21,this.__worldMatrix.m22,this.__worldMatrix.dx,this.__worldMatrix.dy);b.drawImage(this.__theImages[this.__currentIdx][0],0,0);},translate:function(a,b){this.__localMatrix.translate(a,b);this.__markMatrixDirty();},rotate:function(a){this.__localMatrix.rotate(a);this.__markMatrixDirty();},scale1:function(a){this.__localMatrix.scale1(a);this.__markMatrixDirty();},scale2:function(b,a){this.__localMatrix.scale2(b,a);this.__markMatrixDirty();},makeTranslate:function(a,b){this.__localMatrix.makeTranslate(a,b);this.__markMatrixDirty();},makeRotate:function(a){this.__localMatrix.makeRotate(a);this.__markMatrixDirty();},makeScale1:function(a){this.__localMatrix.makeScale1(a);this.__markMatrixDirty();},makeScale2:function(b,a){this.__localMatrix.makeScale2(b,a);this.__markMatrixDirty();},resetMatrix:function(){this.__localMatrix.identity();this.__markMatrixDirty();}});FZ.spriteManager={__sprites:{},addResource:function(c,d,b,a,f,e){FZ.ResourceManager.addResource({Name:c,Type:"Image",URL:b,callback:function(h){if(e===1){FZ.spriteManager.__sprites[c]=new FZ.Sprite([h]);}else{var g=[];for(var j=0;j<e;++j){var k=document.createElement("canvas");k.width=h.width/e;k.height=h.height;k.getContext("2d").drawImage(h,h.width/e*j,0,h.width/e,h.height,0,0,h.width/e,h.height);g.push([k]);}FZ.spriteManager.__sprites[c]=new FZ.Sprite(g);}FZ.spriteManager.__sprites[c].makeTranslate(a,f);}});},getSprite:function(a){return this.__sprites[a];}};})();(function(){FZ.Math={lerp:function(e,d,c){e=e<0?0:e>1?1:e;return c*e+(1-e)*d;},random:function(d,c){return FZ.Math.lerp(Math.random(),d,c);},clamp:function(b,a,c){return b<a?a:b>c?c:b;},round:function(b,a){a=Math.pow(10,a||0);return Math.round(b*a)/a;},Vector2:FZ.newClass({x:0,y:0,init:function(b,a){if(a!==undefined){this.x=b?b:0;this.y=a?a:0;}},clone:function(){return new FZ.Math.Vector2(this.x,this.y);},add:function(b,a){if(a===undefined){a=new FZ.Math.Vector2();}a.x=this.x+b.x;a.y=this.y+b.y;return a;},sub:function(b,a){if(a===undefined){a=new FZ.Math.Vector2();}a.x=this.x-b.x;a.y=this.y-b.y;return a;},normalize:function(a){if(a===undefined){a=new FZ.Math.Vector2();}var b=1/this.length();a.x=this.x*b;a.y=this.y*b;return a;},scale:function(b,a){if(a===undefined){a=new FZ.Math.Vector2();}a.x=this.x*b;a.y=this.y*b;return a;},applyTransform:function(b,a){if(a===undefined){a=new FZ.Math.Vector2();}tx=b.m11*this.x+b.m21*this.y+b.dx;ty=b.m12*this.x+b.m22*this.y+b.dy;a.x=tx;a.y=ty;return a;},dot:function(a){return this.x*a.x+this.y*a.y;},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y);},lengthSquared:function(){return this.x*this.x+this.y*this.y;}}),Matrix3:FZ.newClass({m11:1,m21:0,dx:0,m12:0,m22:1,dy:0,set:function(d,c,f,e,b,a){this.m11=d;this.m21=f;this.dx=b;this.m12=c;this.m22=e;this.dy=a;return this;},clone:function(){var a=new FZ.Math.Matrix3();a.m11=this.m11;a.m21=this.m21;a.m12=this.m12;a.m22=this.m22;a.dx=this.dx;a.dy=this.dy;return a;},identity:function(){this.m11=1;this.m21=0;this.dx=0;this.m12=0;this.m22=1;this.dy=0;return this;},mul:function(e,g){if(g===undefined){g=new FZ.Math.Matrix3();}var c=this.m11*e.m11+this.m21*e.m12;var f=this.m11*e.m21+this.m21*e.m22;var b=this.m12*e.m11+this.m22*e.m12;var d=this.m12*e.m21+this.m22*e.m22;var a=this.dx+this.m11*e.dx+this.m21*e.dx;var h=this.dy+this.m12*e.dx+this.m22*e.dy;g.m11=c;g.m21=f;g.m12=b;g.m22=d;g.dx=a;g.dy=h;return g;},makeRotate:function(a){var b=Math.sin(a),d=Math.cos(a);this.m11=d;this.m21=-b;this.m12=b;this.m22=d;return this;},rotate:function(f){var g=Math.sin(f),h=Math.cos(f);var b=this.m11*h+this.m21*g;var e=-this.m11*g+this.m21*h;var a=this.m12*h+this.m22*g;var d=-this.m12*g+this.m22*h;this.m11=b;this.m21=e;this.m12=a;this.m22=d;return this;},makeScale1:function(a){return this.makeScale2(a,a);},scale1:function(a){return this.scale2(a,a);},makeScale2:function(b,a){this.m11=b;this.m22=a;this.m12=0;this.m21=0;return this;},scale2:function(b,a){this.m11*=b;this.m21*=a;this.m12*=b;this.m22*=a;return this;},makeTranslate:function(a,b){this.dx=a;this.dy=b;return this;},translate:function(a,b){this.dx+=this.m11*a+this.m21*b;this.dy+=this.m12*a+this.m22*b;return this;},inverseAffine:function(f){if(f===undefined){f=new FZ.Math.Matrix3();}var g=1/(this.m11*this.m22-this.m21*this.m12);var c=this.m22*g;var e=this.m12*g;var b=this.m21*g;var d=this.m11*g;var a=-(c*this.dx+e*this.dy);var h=-(b*this.dx+d*this.dy);f.m11=c;f.m21=e;f.m12=b;f.m22=d;f.dx=a;f.dy=h;return f;}})};})();(function(){FZ.JSON={parse:function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j;}throw new SyntaxError("JSON.parse");},stringify:function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" ";}}else{if(typeof space==="string"){indent=space;}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");}return str("",{"":value});}};function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);}if(typeof rep==="function"){value=rep.call(holder,key,value);}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null";}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null";}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v;}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v);}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function f(n){return n<10?"0"+n:n;}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}})();(function(){FZ.ControlManager={m_monitor_list:[],Mouse:{x:0,y:0,leftKey:false,middleKey:false,rightKey:false},MouseMove:function(a){if(a.offsetX){this.Mouse.x=a.offsetX;this.Mouse.y=a.offsetY;}else{if(a.layerX){this.Mouse.x=a.layerX-FZ.GameBase.MainCanvas.offsetLeft;this.Mouse.y=a.layerY-FZ.GameBase.MainCanvas.offsetTop;}}},MouseUp:function(c){if(c.button!==0){return;}this.Mouse.leftKey=false;for(var a=0;a<this.m_monitor_list.length;a++){var b=this.m_monitor_list[a];if((b)&&(b.CustomMouseUp)){b.CustomMouseUp(this.Mouse);}}},MouseDown:function(c){if(c.button!==0){return;}this.Mouse.leftKey=true;for(var a=0;a<this.m_monitor_list.length;a++){var b=this.m_monitor_list[a];if((b)&&(b.CustomMouseDown)){b.CustomMouseDown(this.Mouse);}}},addMonitor:function(b){var a=FZ.ArrayIndexof(this.m_monitor_list,b);if(-1===a){this.m_monitor_list.push(b);}},removeMonitor:function(b){var a=FZ.ArrayIndexof(this.m_monitor_list,b);if(-1!==a){this.m_monitor_list.splice(a,1);}},clearMonitor:function(){while(this.m_monitor_list.length>0){this.m_monitor_list.pop();}}};})();(function(){FZ.Music={theAudio:null,theIntervalId:0,isMute:false,set:function(b,a){this.loop=Boolean(a);this.theAudio=b;b.loop=a;},setMute:function(a){this.isMute=a;if(this.isMute){this.stop();}else{this.play();}},play:function(){if(this.isMute){return;}this.stop();this.theAudio.play();if(this.theAudio.duration){if(this.loop){this.theIntervalId=window.setInterval(this.replay,Math.floor(this.theAudio.duration*1000)-1000);}else{window.setTimeout(function(){this.theAudio.pause();try{this.theAudio.currentTime=0;}catch(a){}},Math.floor(this.theAudio.duration*1000)-1000);}}},stop:function(){if(!this.theAudio){return;}this.theAudio.pause();try{this.theAudio.currentTime=0;}catch(a){}window.clearInterval(this.theIntervalId);},replay:function(){FZ.Music.stop();FZ.Music.play();},pageHide:function(a){if(FZ.Music.theAudio){FZ.Music.stop();}},pageShow:function(a){if(FZ.Music.theAudio){FZ.Music.play();}}};window.addEventListener("pagehide",FZ.Music.pageHide,false);window.addEventListener("pageshow",FZ.Music.pageShow,false);})();(function(){FZ.StateDefs={STATE_UNKNOW:-1,STATE_INIT:5,STATE_LOAD:10,STATE_NORMAL:15,STATE_HIDE:20,STATE_SHOW_NO_LOGIC:25,STATE_UNLOAD:30,STATE_DESTROY:35,GAME_STATE_UNKNOW:"",GAME_STATE_PRELOADING:"gamepreloading",GAME_STATE_LOADING:"gameloading",GAME_STATE_LOGO:"gamelogo",GAME_STATE_MAINMEN:"gamemainmenu",GAME_STATE_HOW_TO_PLAY:"gamehowtoplay",GAME_STATE_GAME_IN:"gamein",GAME_STATE_STATS:"gamestats",GAME_STATE_ACHIEVEMENT:"gameachievement",GAME_STATE_RESET:"gamereset",GAME_STATE_OVER:"gameover",GAME_STATE_COMPLETE:"complete",GAME_STATE_GOTO_MAINMENU:"gamegotomainmenu"};FZ.CreateTextDiv=function(a,f,b,d,c){var e=null;d=d+2;e=document.createElement("div");e.style.position="absolute";e.style.width=b+"px";e.style.height=d+"px";e.style.left=a+"px";e.style.top=f+"px";e.style.color=c;e.style.fontFamily="Arial";e.style.textAlign="center";e.style.lineHeight=d+"px";e.style.fontSize=d+"px";e.zIndex=5;return e;};})();(function(){FZ.ImageConfig=[{name:"blockBlue",zOrder:0,fileURL:"blockBlue.png",x:6,y:150,w:32,h:32,tags:["blocks"],cols:1},{name:"blockBlue_over",zOrder:0,fileURL:"blockBlue_over.png",x:46,y:150,w:32,h:32,tags:["blocks"],cols:1},{name:"blockGreen",zOrder:0,fileURL:"blockGreen.png",x:86,y:150,w:32,h:32,tags:["blocks"],cols:1},{name:"blockGreen_over",zOrder:0,fileURL:"blockGreen_over.png",x:126,y:150,w:32,h:32,tags:["blocks"],cols:1},{name:"blockPurple",zOrder:0,fileURL:"blockPurple.png",x:166,y:150,w:32,h:32,tags:["blocks"],cols:1},{name:"blockPurple_over",zOrder:0,fileURL:"blockPurple_over.png",x:206,y:150,w:32,h:32,tags:["blocks"],cols:1},{name:"blockRed",zOrder:0,fileURL:"blockRed.png",x:246,y:150,w:32,h:32,tags:["blocks"],cols:1},{name:"blockRed_over",zOrder:0,fileURL:"blockRed_over.png",x:286,y:150,w:32,h:32,tags:["blocks"],cols:1},{name:"shellBlue",zOrder:2,fileURL:"shellBlue.png",x:80,y:260,w:32,h:32,tags:["blocks"],cols:1},{name:"shellGreen",zOrder:0,fileURL:"shellGreen.png",x:130,y:260,w:32,h:32,tags:["blocks"],cols:1},{name:"shellPurple",zOrder:0,fileURL:"shellPurple.png",x:180,y:260,w:32,h:32,tags:["blocks"],cols:1},{name:"shellRed",zOrder:0,fileURL:"shellRed.png",x:230,y:260,w:32,h:32,tags:["blocks"],cols:1},{name:"btnHelp",zOrder:1,fileURL:"btnHelp.png",x:130,y:332,w:73,h:72,tags:["mainmenu"],cols:1},{name:"btnHelp_over",zOrder:1,fileURL:"btnHelp_over.png",x:130,y:332,w:73,h:72,tags:["mainmenu"],cols:1},{name:"btnPopBack",zOrder:1,fileURL:"btnPopBack.png",x:116,y:20,w:91,h:36,tags:["popMenu"],cols:1},{name:"btnPopBack_over",zOrder:1,fileURL:"btnPopBack_over.png",x:116,y:20,w:91,h:36,tags:["popMenu"],cols:1},{name:"btnPopHelp",zOrder:1,fileURL:"btnPopHelp.png",x:116,y:-10,w:91,h:36,tags:["popMenu"],cols:1},{name:"btnPopHelp_over",zOrder:1,fileURL:"btnPopHelp_over.png",x:116,y:-10,w:91,h:36,tags:["popMenu"],cols:1},{name:"btnPopMenu",zOrder:1,fileURL:"btnPopMenu.png",x:116,y:20,w:92,h:36,tags:["popMenu"],cols:1},{name:"btnPopMenu_over",zOrder:1,fileURL:"btnPopMenu_over.png",x:116,y:20,w:92,h:36,tags:["popMenu"],cols:1},{name:"btnPopNew",zOrder:1,fileURL:"btnPopNew.png",x:20,y:-10,w:92,h:36,tags:["popMenu"],cols:1},{name:"btnPopNew_over",zOrder:1,fileURL:"btnPopNew_over.png",x:20,y:-10,w:92,h:36,tags:["popMenu"],cols:1},{name:"btnPopQuit",zOrder:1,fileURL:"btnPopQuit.png",x:216,y:-10,w:91,h:36,tags:["popMenu"],cols:1},{name:"btnPopQuit_over",zOrder:1,fileURL:"btnPopQuit_over.png",x:216,y:-10,w:91,h:36,tags:["popMenu"],cols:1},{name:"btnCompleteRestart",zOrder:2,fileURL:"btnRestart.png",x:56,y:236,w:92,h:36,tags:["gamecomplete"],cols:1},{name:"btnCompleteRestart_over",zOrder:2,fileURL:"btnRestart_over.png",x:56,y:236,w:92,h:36,tags:["gamecomplete"],cols:1},{name:"btnCompleteGoMenu",zOrder:2,fileURL:"btnGoMenu.png",x:176,y:236,w:91,h:36,tags:["gamecomplete"],cols:1},{name:"btnCompleteGoMenu_over",zOrder:2,fileURL:"btnGoMenu_over.png",x:176,y:236,w:91,h:36,tags:["gamecomplete"],cols:1},{name:"btnOverRestart",zOrder:2,fileURL:"btnRestart.png",x:56,y:236,w:92,h:36,tags:["gameover"],cols:1},{name:"btnOverRestart_over",zOrder:2,fileURL:"btnRestart_over.png",x:56,y:236,w:92,h:36,tags:["gameover"],cols:1},{name:"btnOverGoMenu",zOrder:2,fileURL:"btnGoMenu.png",x:176,y:236,w:91,h:36,tags:["gameover"],cols:1},{name:"btnOverGoMenu_over",zOrder:2,fileURL:"btnGoMenu_over.png",x:176,y:236,w:91,h:36,tags:["gameover"],cols:1},{name:"btnSound",zOrder:1,fileURL:"btnSound.png",x:230,y:310,w:75,h:70,tags:["mainmenu"],cols:1},{name:"btnSound_over",zOrder:1,fileURL:"btnSound_over.png",x:230,y:310,w:75,h:70,tags:["mainmenu"],cols:1},{name:"btnStart",zOrder:1,fileURL:"btnStart.png",x:10,y:300,w:88,h:88,tags:["mainmenu"],cols:1},{name:"btnStart_over",zOrder:1,fileURL:"btnStart_over.png",x:10,y:300,w:88,h:88,tags:["mainmenu"],cols:1},{name:"loading_bar",zOrder:1,fileURL:"loading_bar.png",x:44,y:342,w:231,h:13,tags:["loading"],cols:1},{name:"loading_box",zOrder:2,fileURL:"loading_box.png",x:44,y:341,w:233,h:15,tags:["loading"],cols:1},{name:"loading_bg",zOrder:0,fileURL:"loading_bg.png",x:0,y:0,w:320,h:480,tags:["loading"],cols:1},{name:"menu_bg",zOrder:0,fileURL:"menu_bg.png",x:15,y:-17,w:288,h:45,tags:["popMenu"],cols:1},{name:"safe_zone",zOrder:0,fileURL:"safe_zone.png",x:34,y:93,w:250,h:250,tags:["loading"],cols:1},{name:"shelles",zOrder:0,fileURL:"shelles.png",x:6,y:200,w:128,h:32,tags:["blocks"],cols:4},{name:"SpilSplash",zOrder:0,fileURL:"SpilSplash.png",x:0,y:50,w:320,h:320,tags:["loading"],cols:1},{name:"uiAllBg",zOrder:0,fileURL:"uiAllBg.png",x:0,y:0,w:320,h:480,tags:["gameover","gamecomplete"],cols:1},{name:"uiComplete",zOrder:0,fileURL:"uiComplete.png",x:32,y:126,w:250,h:172,tags:["gamecomplete"],cols:1},{name:"uiFailed",zOrder:1,fileURL:"uiFailed.png",x:32,y:126,w:250,h:172,tags:["gameover"],cols:1},{name:"uiHelp",zOrder:2,fileURL:"uiHelp.png",x:17,y:61,w:288,h:320,tags:["help"],cols:1},{name:"uiMainHelp",zOrder:2,fileURL:"uiMainHelp.png",x:17,y:61,w:297,h:329,tags:["help"],cols:1},{name:"btnHelpBack",zOrder:2,fileURL:"btnPopBack.png",x:120,y:352,w:91,h:36,tags:["popMenu"],cols:1},{name:"btnHelpBack_over",zOrder:2,fileURL:"btnPopBack_over.png",x:120,y:352,w:91,h:36,tags:["popMenu"],cols:1},{name:"uiGameBg",zOrder:0,fileURL:"uiGameBg.png",x:0,y:0,w:320,h:480,tags:["game"],cols:1},{name:"uiLevelClear",zOrder:0,fileURL:"uiLevelClear.png",x:40,y:170,w:236,h:78,tags:["clear"],cols:1},{name:"uiMainBg",zOrder:0,fileURL:"uiMainBg.png",x:0,y:0,w:320,h:480,tags:["mainmenu"],cols:1}];FZ.ImageTags={};for(var b=0;b<FZ.ImageConfig.length;++b){for(var a=0;a<FZ.ImageConfig[b].tags.length;++a){if(!FZ.ImageTags.hasOwnProperty(FZ.ImageConfig[b].tags[a])){FZ.ImageTags[FZ.ImageConfig[b].tags[a]]=[];}FZ.ImageTags[FZ.ImageConfig[b].tags[a]].push(FZ.ImageConfig[b]);}}FZ.GetImageInfoByName=function(d){var e=null;for(var c=0;c<FZ.ImageConfig.length;c++){e=FZ.ImageConfig[c];if(d===e.name){return e;}}return null;};FZ.GetImageConfigByName=function(c){for(var d=FZ.ImageConfig.length-1;d>=0;--d){if(FZ.ImageConfig[d].name===c){return FZ.ImageConfig[d];}}return null;};})();(function(){FZ.GameDefs={SCREEN_W:320,SCREEN_H:480,SWITCH_ON:0,SWITCH_OFF:1,TIME_RATE:8,HALF_ACCELERATION_OF_GRAVITY:5,DIAMOND_SPEED_X:6,DIAMOND_SPEED_Y:6,FALLING_SPEED_X:4,FALLING_SPEED_Y:-4,ANIM_NEXT_SHOW_TIME:2000,ANIM_NEXT_X:190,ANIM_NEXT_Y:200,DIAMOND_RORATE_NONE:0,DIAMOND_RORATE_LEFT:1,DIAMOND_RORATE_RIGHT:2,DIAMOND_RORATE_RATE:20,GAME_STATE_UNKNOW:-1,GAME_STATE_LOADING:0,GAME_STATE_INIT:1,GAME_STATE_GAME:2,DIAMOND_TYPE_RED:0,DIAMOND_TYPE_GREEN:1,DIAMOND_TYPE_ORANGE:2,DIAMOND_TYPES:3,DIAMOND_LINE_NUM:10,DIAMOND_COL_NUM:9,ALL_DIAMOND_NUM:10*9,DIAMOND_CENTER_COL:((9-1)>>1),MOVE_EFFECT_TIME:800,FALLING_EFFECT_TIME:1500,GAME_CLEAR_TIME:1500,DIAMOND_OFFSET_X:16,DIAMOND_OFFSET_Y:60,DIAMOND_WIDTH:32,DIAMOND_HEIGHT:32,GRID_WIDTH:32,GRID_HEIGHT:32,STR_GAME_ICONS_OFFSET_X:20,FONT_SIZE:20,STATS_FONT_SIZE:18,SEARCH_NONE:0,SEARCH_INIT:1,SEARCH_ING:2,SEARCH_FINISHED:3,MIN_SAME_DIAMONDS_NUM:2,DIAMOND_STATE_NONE:0,DIAMOND_STATE_INIT:1,DIAMOND_STATE_NORMAL:2,DIAMOND_STATE_MOVING:3,DIAMOND_STATE_FALLING:4,DIAMOND_STATE_DESTORY:5,POP_MENU_OFFSETX:0,POP_MENU_OFFSETY:0,ANDRIOD_OFFSETY:-20,POP_MENU_W:320,POP_MENU_H:50,SHOW_HIDE_OFFSETY:40,CHEAT_MODE_NONE:-1,CHEAT_MODE_INVINCIBLE:1,CHEAT_MODE_SHELL:2,CHEAT_MSG_PROMPT:"Please enter your cheat code :",CHEAT_MSG_DISABLE:"Disable the Cheat code!",CHEAT_MSG_INVINCIBLE:"Your in invincible mode!",CHEAT_MSG_SHELL:"Your in shell mode!",MAX_LEVEL:16,BLOCK_SCORE_BASE:10,BLOCK_SCORE_UNIT:5,SHELL_SCORE_BASE:10,SHELL_SCORES:[300,800,1500,2400],UI_SHELLES_POS:[{x:22,y:396},{x:40,y:380},{x:60,y:380},{x:80,y:390}],LEVEL_LEFT_BLOCK:[70,73,76,79,82,85,88,91,94,96,98,100,102,103,104,105,105,105],SHELL_MOVE_BLOCK:[10,10,10,12,12,12,14,14,14,15,15,15,15,15,15,15,15,15],SND_BG:"BGMusic",SND_DEF:"./res/music/html5aqua.mp3",BLOCK_STYLES:[{index:0,imgs:["blockBlue","blockBlue_over"],shell:"shellBlue"},{index:1,imgs:["blockGreen","blockGreen_over"],shell:"shellGreen"},{index:2,imgs:["blockPurple","blockPurple_over"],shell:"shellPurple"},{index:3,imgs:["blockRed","blockRed_over"],shell:"shellRed"}],BLOCK_STYLE_UNKNOW:-1,BLOCK_STYLE_BLUE:0,BLOCK_STYLE_GREEN:1,BLOCK_STYLE_PURPLE:2,BLOCK_STYLE_RED:3,BLOCK_STYLE_NUMBER:4,TXT_MAIN_SCORE:[125,290,70,20],TXT_GAMEIN_LEVEL:[70,32,40,20],TXT_GAMEIN_BLOCK:[260,32,50,20],TXT_GAMEIN_SCORE:[230,390,70,20],TXT_GAME_OVER_SCORE:[125,216,70,18],TXT_GAME_COMPLETE_SCORE:[125,216,70,18],getInfoByStyle:function(b){var a=0;var c=null;for(a=0;a<this.BLOCK_STYLES.length;a++){c=FZ.GameDefs.BLOCK_STYLES[a];if(b===c.index){return c;}}return null;}};})();(function(){FZ.EvtDefs={EVT_START_GAME:"startgame",EVT_UPDATE_UI:"updateui",EVT_ADD_SCORE:"addscore",EVT_HELP_BACK:"helpback",EVT_SWT_CLICK:"swtclick"};})();(function(){FZ.DivManager={m_init:false,m_parentContainer:null,m_display_list:null,offsetLeft:0,offsetTop:0,init:function(){if(this.m_init){return;}this.m_init=true;this.m_parentContainer=null;this.m_display_list=(this.m_display_list||[]);},setSize:function(a,b){if(null===this.m_parentContainer){return;}this.m_parentContainer.style.width=a+"px";this.m_parentContainer.style.height=b+"px";},setParent:function(a){this.m_parentContainer=a;this.m_parentContainer.style.position="absolute";this.m_parentContainer.style.overflow="hidden";this.offsetLeft=this.m_parentContainer.offsetLeft;this.offsetTop=this.m_parentContainer.offsetTop;},setOffset:function(b,a){this.offsetLeft=b;this.offsetTop=a;},getOffsetX:function(){this.offsetLeft=this.m_parentContainer.offsetLeft;return this.offsetLeft;},getOffsetY:function(){this.offsetTop=this.m_parentContainer.offsetTop;return this.offsetTop;},setOverflow:function(a){if(this.m_parentContainer){this.m_parentContainer.style.overflow=a;}},onmousemove:function(a){var b=0;b=5;},addChild:function(a){this.m_parentContainer.appendChild(a);this.m_display_list.push(a);},removeChild:function(b){var a=-1;for(a=0;a<this.m_parentContainer.childNodes.length;a++){if(b==this.m_parentContainer.childNodes[a]){this.m_parentContainer.removeChild(b);break;}}a=FZ.ArrayIndexof(this.m_display_list,b);if(-1!==a){this.m_display_list.splice(a,1);}},removeAllChild:function(){var a=null;while(this.m_display_list.length>0){a=this.m_display_list.pop();if(this.m_parentContainer.contains(a)){this.m_parentContainer.removeChild(a);}}}};})();(function(){FZ.Evt=FZ.newClass({m_type:null,m_target:null,init:function(a,b){this.m_type=a;this.m_target=b;},getType:function(){return this.m_type;},getTarget:function(){return this.m_target;}});})();(function(){FZ.ScoreEvt=FZ.newClass({m_score:0,init:function(a,b,c){this.m_type=a;this.m_target=b;this.m_score=c;},getScore:function(){return this.m_score;}},FZ.Evt);})();(function(){var b=null;var a=function(c,f){var e=null;var d=0;for(d=0;d<c.length;d++){b=c[d];if((b)&&(f===b.m_callback)){return d;}}return -1;};FZ.EvtManager={m_listener:null,init:function(){this.m_listener={};},addListener:function(f,c,e){var d=null;d=this.m_listener[c];if(!d){this.m_listener[c]=[];d=this.m_listener[c];}if(-1===a(d,e)){b={};b.m_listener=f;b.m_callback=e;d.push(b);}},removeListener:function(d,f){var c=0;var e=null;e=this.m_listener[d];if(!e){return;}c=a(e,f);if(-1!==c){e.splice(c,1);}},sendEvt:function(d){var c=false;var e=0;var g=null;var f=null;f=d.getType();g=this.m_listener[f];if(!g){return;}for(e=0;e<g.length;e++){b=g[e];c=b.m_callback.call(b.m_listener,d);if(c){break;}}}};FZ.EvtManager.init();})();(function(){FZ.GameBase.setCss=function(b,a){b.style.width=a.w+"px";b.style.height=a.h+"px";b.style.left=a.x+"px";b.style.top=a.y+"px";b.style.position="absolute";b.style.backgroundRepeat="no-repeat";if(a.fileURL){b.style.backgroundImage="url(res/images/"+a.fileURL+")";}};FZ.BaseState=FZ.newClass({StateName:"GameStateBase",m_remove_div:false,m_timer:null,m_main_div:null,m_ui_list:null,m_btn_list:null,init:function(){FZ.GameBase.registerState(this.StateName,this);this.m_main_div=document.createElement("div");this.m_main_div.style.webkitTransition="opacity, translate";this.m_ui_list=[];this.m_btn_list=[];},createUIs:function(c){var a=0;var b=null;var d=null;for(a=0;a<c.length;a++){b=FZ.GetImageInfoByName(c[a]);d=document.createElement("div");FZ.GameBase.setCss(d,b);this.m_ui_list.push(d);this.m_main_div.appendChild(d);}},createBtns:function(e,a){var c=null;var b=0;var d=null;var f=null;for(b=0;b<e.length;b++){d=FZ.GetImageInfoByName(e[b][0]);f=FZ.GetImageInfoByName(e[b][1]);c=new FZ.UIButton(d.w,d.h,d.cols,d.fileURL,f.fileURL);c.setPos(d.x,d.y);c.addMonitor(this);this.m_btn_list.push(c);if(a){this.m_main_div.appendChild(c.m_div);}}},createSwitches:function(f,a){var c=0;var b=null;var e=null;var g=null;var d=[];for(c=0;c<f.length;c++){e=FZ.GetImageInfoByName(f[c][0]);g=FZ.GetImageInfoByName(f[c][1]);b=new FZ.UISwitch(e.w,e.h,e.cols,e.fileURL,g.fileURL);b.setPos(e.x,e.y);d.push(b);if(a){this.m_main_div.appendChild(b.m_div);}}return d;},resetTranslate:function(a){this.m_remove_div=false;this.m_main_div.style.display="block";this.m_main_div.style.zIndex=0;this.m_main_div.style.webkitTransitionDuration="0s";this.m_main_div.style.opacity=a;this.m_main_div.style.webkitTransform="translate(0px, 0px) rotate(0deg)";},fade_in:function(c,b){var a=this;this.m_remove_div=false;this.m_main_div.style.webkitTransitionDuration=c+"ms";this.m_main_div.style.opacity=b;this.m_main_div.style.webkitTransform="translate(0px, 0px) rotate(0deg)";},fade_out:function(d,c,e){var b=this;var a=FZ.GameDefs.SCREEN_W;var f=0;this.m_remove_div=true;this.m_main_div.style.webkitTransitionDuration=d+"ms";setTimeout(function(){b.m_main_div.style.opacity=c;b.m_main_div.style.webkitTransform="translate("+a+"px, "+f+"0px) rotate("+e+"deg)";},1);setTimeout(function(){if(b.m_remove_div){b.m_main_div.style.display="none";}},d);},preProcess:function(){},postProcess:function(){},AIUpdate:function(a){}});})();(function(){FZ.Game={};FZ.Game.checkButtun=function(b){var a=b.getPosition();if(FZ.ControlManager.Mouse.x>a.x&&FZ.ControlManager.Mouse.y>a.y&&FZ.ControlManager.Mouse.x<a.x+b.__theImages[0][0].width&&FZ.ControlManager.Mouse.y<a.y+b.__theImages[0][0].height){b.setFrame(1+(FZ.ControlManager.Mouse.leftKey?1:0));return true;}else{b.setFrame(0);}return false;};FZ.Game.PreLoadingState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_PRELOADING,m_test_timer:0,preProcess:function(){FZ.spriteManager.addResource("loading_bg",0,"res/images/loading_bg.png",0,0,1);FZ.spriteManager.addResource("loading_bar",0,"res/images/loading_bar.png",0,0,1);FZ.spriteManager.addResource("SpilSplash",0,"res/images/SpilSplash.png",0,0,1);FZ.spriteManager.addResource("safe_zone",0,"res/images/safe_zone.png",0,0,1);this.m_timer=setTimeout(FZ.Tools.bind(this,this.AIUpdate),500);},postProcess:function(){},AIUpdate:function(){if(FZ.ResourceManager.isResourceLoaded()){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_LOGO);}else{this.m_timer=setTimeout(FZ.Tools.bind(this,this.AIUpdate),200);}}},FZ.BaseState))();})();FZ.Block=FZ.newClass({m_style:FZ.GameDefs.STYLE_UNKNOW,m_state:FZ.GameDefs.DIAMOND_STATE_NONE,m_used:false,m_line:0,m_col:0,m_x:0,m_y:0,m_search_flag:0,m_div:null,m_back_list:null,m_timer:null,init:function(){this.m_style=FZ.GameDefs.BLOCK_STYLE_UNKNOW;this.m_search_flag=FZ.GameDefs.SEARCH_NONE;this.m_state=FZ.GameDefs.DIAMOND_STATE_NONE;this.m_back_list=[];this.createEle();},createEle:function(){this.m_div=document.createElement("div");this.m_div.style.width=FZ.GameDefs.GRID_WIDTH+"px";this.m_div.style.height=FZ.GameDefs.GRID_HEIGHT+"px";this.m_div.style.position="absolute";this.m_div.style.webkitTransition="opacity, translate";this.m_div.style.backgroundRepeat="no-repeat";},setUsed:function(a){this.m_used=a;},getUsed:function(){return this.m_used;},setBlock:function(a,c,d){var e=null;var b=null;var f=null;if(this.m_timer){clearTimeout(this.m_timer);this.m_timer=null;}this.m_back_list.splice(0,this.m_back_list.length);this.m_state=FZ.GameDefs.DIAMOND_STATE_NONE;this.m_search_flag=FZ.GameDefs.SEARCH_NONE;this.m_line=a;this.m_col=c;this.m_x=this.m_col*FZ.GameDefs.GRID_WIDTH+FZ.GameDefs.DIAMOND_OFFSET_X;this.m_y=this.m_line*FZ.GameDefs.GRID_HEIGHT+FZ.GameDefs.DIAMOND_OFFSET_Y;this.m_style=Math.floor(d);f=FZ.GameDefs.getInfoByStyle(this.m_style).imgs;e=FZ.GetImageInfoByName(f[0]);b="url(res/images/"+e.fileURL+")";this.m_back_list.push(b);e=FZ.GetImageInfoByName(f[1]);b="url(res/images/"+e.fileURL+")";this.m_back_list.push(b);this.setCss();this.setBlockBack();},setCss:function(){var a=this;a.m_div.style.webkitTransition="";a.m_div.webkitTransitionDuration="0ms";setTimeout(function(){a.show();a.m_div.style.opacity=1;a.m_div.style.webkitTransform="translate("+(a.m_x)+"px, "+(a.m_y)+"px)";a.m_div.style.webkitTransition="opacity, translate";},0);},setBlockBack:function(){var a=null;if(FZ.GameDefs.SEARCH_FINISHED===this.m_search_flag){a=this.m_back_list[1];}else{a=this.m_back_list[0];}if(this.m_last_back===a){return;}this.m_div.style.backgroundImage=a;this.m_last_back=a;},destroy:function(){if(this.m_div.parentNode){}},hide:function(){var a=this;this.m_div.style.webkitTransitionDuration="0ms";this.m_div.style.visibility="hidden";},show:function(){this.m_div.style.visibility="visible";},setDestLine:function(a){this.m_y=FZ.GameDefs.GRID_WIDTH*a+FZ.GameDefs.DIAMOND_OFFSET_Y;this.m_state=FZ.GameDefs.DIAMOND_STATE_MOVING;},setDestCol:function(a){this.m_x=FZ.GameDefs.GRID_WIDTH*a+FZ.GameDefs.DIAMOND_OFFSET_X;this.m_state=FZ.GameDefs.DIAMOND_STATE_MOVING;},setMoveEffect:function(a,c){var b=this;if(FZ.GameDefs.DIAMOND_STATE_MOVING!==this.m_state){return;}this.m_state=FZ.GameDefs.DIAMOND_STATE_NONE;this.m_div.style.webkitTransitionDuration=a+"ms";this.m_div.style.webkitTransform="translate("+(b.m_x)+"px, "+(b.m_y)+"px)";},setFallEffect:function(b,d){var c=this;var f=0;var a=0;var e=0;if(FZ.GameDefs.DIAMOND_STATE_DESTORY===this.m_state){return;}f=FZ.Math.random(0,Math.PI*2);a=FZ.Math.random(100,150);e=a*Math.sin(f);this.m_x+=e;e=a*Math.cos(f);this.m_y+=e;this.m_state=FZ.GameDefs.DIAMOND_STATE_DESTORY;this.m_div.style.webkitTransitionDuration=b+"ms";this.m_div.style.opacity=0;this.m_div.style.webkitTransform="translate("+(c.m_x)+"px, "+(c.m_y)+"px) rotate(170deg)";this.m_timer=setTimeout(function(){c.endFallEffect();},b);},endFallEffect:function(){this.hide();this.m_state=FZ.GameDefs.DIAMOND_STATE_DESTORY;},getStyle:function(){return this.m_style;},getState:function(){return this.m_state;},getSearchFlag:function(){return this.m_search_flag;},setSearchFlag:function(a){this.m_search_flag=a;}});FZ.BlockManager=FZ.newClass({RESULT_NONE:0,RESULT_SAME_BLOCK:1,RESULT_CHANGED:2,m_cur_level:0,m_score:0,m_left_block:0,m_last_selected:-1,m_parent:null,m_observer:null,m_stop_bubble:false,m_call_mOver:null,m_call_mOut:null,m_call_mMove:null,m_call_mClick:null,m_call_tStart:null,m_call_tMove:null,m_call_tEnd:null,m_label_list:null,m_block_lib:null,m_block_show:null,m_block_hide:null,m_centerCol:0,m_get_blocks:0,init:function(){this.m_cur_level=0;this.m_score=0;this.m_left_block=0;this.m_last_selected=-1;this.m_centerCol=0;this.m_block_show=[];this.m_block_hide=[];this.createBlockLib();FZ.EvtManager.addListener(this,FZ.EvtDefs.EVT_ADD_SCORE,this.addShellScore);},createBlockLib:function(){var a=0;var b=null;this.m_block_lib=[];for(a=0;a<FZ.GameDefs.ALL_DIAMOND_NUM;a++){b=null;b=new FZ.Block();this.m_block_lib.push(b);}},addBlockToStage:function(){var a=0;var b=null;for(a=0;a<FZ.GameDefs.ALL_DIAMOND_NUM;a++){b=this.m_block_lib[a];if(this.m_parent){this.m_parent.appendChild(b.m_div);}else{if(b.m_div.parentNode){b.m_div.parentNode.removeChild(b.m_div);}}}},startGame:function(){this.clearAllBlock();this.initAllBlock(true);},addEvent:function(){this.removeEvent();if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){FZ.EventHandler(this,this.m_parent,FZ.EVENT_DEF.T_START,this.mouseHandler);FZ.EventHandler(this,this.m_parent,FZ.EVENT_DEF.T_MOVE,this.mouseHandler);FZ.EventHandler(this,this.m_parent,FZ.EVENT_DEF.T_END,this.mouseHandler);}else{FZ.EventHandler(this,this.m_parent,FZ.EVENT_DEF.M_MOVE,this.mouseHandler);FZ.EventHandler(this,this.m_parent,FZ.EVENT_DEF.M_CLICK,this.mouseHandler);}},removeEvent:function(){if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){FZ.EventRemove(this,this.m_parent,FZ.EVENT_DEF.T_START,this.m_call_tStart);FZ.EventRemove(this,this.m_parent,FZ.EVENT_DEF.T_MOVE,this.m_call_tMove);FZ.EventRemove(this,this.m_parent,FZ.EVENT_DEF.T_END,this.m_call_tEnd);}else{FZ.EventRemove(this,this.m_parent,FZ.EVENT_DEF.M_MOVE,this.m_call_mMove);FZ.EventRemove(this,this.m_parent,FZ.EVENT_DEF.M_CLICK,this.m_call_mClick);}},addBlocksByShell:function(){var a=null;this.m_get_blocks+=FZ.GameDefs.SHELL_MOVE_BLOCK[this.m_cur_level];a=new FZ.Evt(FZ.EvtDefs.EVT_UPDATE_UI,this);FZ.EvtManager.sendEvt(a);},addShellScore:function(b){var a=null;this.m_score+=b.getScore();a=new FZ.Evt(FZ.EvtDefs.EVT_UPDATE_UI,this);FZ.EvtManager.sendEvt(a);},setParent:function(a){if(a){this.m_parent=a;this.addEvent();}else{this.removeEvent();this.m_parent=null;}this.addBlockToStage();},setBubble:function(a){this.m_stop_bubble=a;},setObserver:function(a){this.m_observer=a;},getLeftNumber:function(){this.m_leftNum=this.itIsNoWay();return this.m_leftNum;},getGetBlocks:function(){return this.m_get_blocks;},getLeftBlocks:function(){var a=0;a=FZ.GameDefs.LEVEL_LEFT_BLOCK[this.m_cur_level]-this.m_get_blocks;if(a<0){a=0;}return a;},getCurLevel:function(){return this.m_cur_level;},getLeftBlock:function(){return this.m_left_block;},getScore:function(){return this.m_score;},clearAllBlock:function(){this.m_block_show.splice(0,this.m_block_show.length);this.m_block_hide.splice(0,this.m_block_hide.length);},getStyleByCoord:function(d,b){var c=-1;var a=0;a=d*FZ.GameDefs.DIAMOND_COL_NUM+b;if(this.m_block_show[a]){return this.m_block_show[a].getStyle();}return -1;},clearGame:function(){this.clearAllBlock();},getBlockRef:function(){var b=0;var a=[];for(b=0;b<this.m_block_show.length;b++){if(this.m_block_show[b]){a.push(b);}}return a;},getRandomBlock:function(){var d={};var b=0;var c=0;var a=this.getBlockRef();if(a.length<=0){return null;}b=Math.floor(FZ.Math.random(0,a.length));c=a[b];d.row=Math.floor(c/FZ.GameDefs.DIAMOND_COL_NUM);d.col=(c%FZ.GameDefs.DIAMOND_COL_NUM);if(!this.m_block_show[c]){return null;}d.style=this.m_block_show[c].m_style;return d;},initAllBlock:function(g){var b=0;var d=0;var f=0;var c=0;var e=null;this.m_get_blocks=0;this.clearAllBlock();var a=null;for(c=0;c<FZ.GameDefs.ALL_DIAMOND_NUM;c++){e=this.m_block_lib[c];f=FZ.Math.random(FZ.GameDefs.BLOCK_STYLE_BLUE,FZ.GameDefs.BLOCK_STYLE_NUMBER);b=Math.floor(c/FZ.GameDefs.DIAMOND_COL_NUM);d=(c%FZ.GameDefs.DIAMOND_COL_NUM);e.setBlock(b,d,f);this.m_block_show.push(e);}if((undefined!==g)&&(g)){this.m_score=0;this.m_cur_level=0;this.m_left_block=FZ.GameDefs.LEVEL_LEFT_BLOCK[this.m_cur_level];}else{if(this.m_cur_level<(FZ.GameDefs.MAX_LEVEL-1)){this.m_cur_level++;}this.m_left_block=FZ.GameDefs.LEVEL_LEFT_BLOCK[this.m_cur_level];}this.m_leftNum=-1;if(this.m_observer){this.m_observer.createGameShell();}a=new FZ.Evt(FZ.EvtDefs.EVT_UPDATE_UI,this);FZ.EvtManager.sendEvt(a);this.m_stop_bubble=false;},clearSearchFlag:function(){var b=null;var a=0;for(a=0;a<this.m_block_show.length;a++){b=this.m_block_show[a];if(null!==b){b.setSearchFlag(FZ.GameDefs.SEARCH_NONE);}}},searchBlockRecursive:function(b,d){var c=null;var a=b%FZ.GameDefs.DIAMOND_COL_NUM;if(b<0||(b>(FZ.GameDefs.ALL_DIAMOND_NUM-1))){return;}c=this.m_block_show[b];if((null===c)||(c.getStyle()!==d)){return;}if(FZ.GameDefs.SEARCH_NONE!==c.getSearchFlag()){return;}c.setSearchFlag(FZ.GameDefs.SEARCH_ING);if(a>0){this.searchBlockRecursive(b-1,c.getStyle());}if(b-FZ.GameDefs.DIAMOND_COL_NUM>=0){this.searchBlockRecursive(b-FZ.GameDefs.DIAMOND_COL_NUM,c.getStyle());}if(a<(FZ.GameDefs.DIAMOND_COL_NUM-1)){this.searchBlockRecursive(b+1,c.getStyle());}if(b<=(FZ.GameDefs.ALL_DIAMOND_NUM-1)){this.searchBlockRecursive(b+FZ.GameDefs.DIAMOND_COL_NUM,c.getStyle());}c.setSearchFlag(FZ.GameDefs.SEARCH_FINISHED);},getBlockNumber:function(b){var d=0;var a=0;var c=null;for(a=b;a<(FZ.GameDefs.ALL_DIAMOND_NUM);a+=FZ.GameDefs.DIAMOND_COL_NUM){c=this.m_block_show[a];if(null!==c){d++;}}return d;},getLastWhiteLine:function(c){var a=-1;var b=0;var d=null;b=(FZ.GameDefs.DIAMOND_LINE_NUM-1)*FZ.GameDefs.DIAMOND_COL_NUM+c;for(;b>0;b-=FZ.GameDefs.DIAMOND_COL_NUM){d=this.m_block_show[b];if(null===d){a=Math.floor(b/FZ.GameDefs.DIAMOND_COL_NUM);break;}}if(a>=FZ.GameDefs.DIAMOND_LINE_NUM){alert("there is an mistake!");}return a;},getCenterCol:function(e,b){var c=0;var a=0;var d=0;var f=FZ.GameDefs.DIAMOND_COL_NUM-1;for(d=e;d<FZ.GameDefs.DIAMOND_COL_NUM;d++){c=this.getBlockNumber(d);if(c<=0){break;}}if(d>=FZ.GameDefs.DIAMOND_COL_NUM){return -1;}for(f=b;f>=0;f--){c=this.getBlockNumber(f);if(c<=0){break;}}a=Math.floor((d+f)/2);return a;},getLastRightCol:function(c,a){var b=0;var d=-1;for(b=a;b>c;b--){if(this.getBlockNumber(b)<=0){d=b;break;}}return d;},getLastLeftCol:function(c,a){var b=0;var d=-1;for(b=a;b<c;b++){if(this.getBlockNumber(b)<=0){d=b;break;}}return d;},blockMoveTo:function(f,c,h){var e=0;var d=0;var g=null;var b=0;var a=c;if(h){a=this.getLastRightCol(f,c);}else{a=this.getLastLeftCol(f,c);}c=a;if(-1===c){return;}for(b=0;b<FZ.GameDefs.DIAMOND_LINE_NUM;b++){e=b*FZ.GameDefs.DIAMOND_COL_NUM+f;d=b*FZ.GameDefs.DIAMOND_COL_NUM+c;g=this.m_block_show[e];this.m_block_show[d]=this.m_block_show[e];this.m_block_show[e]=null;if(null!==g){g.setDestCol(c);}}},blockDownMove:function(){var d=0;var c=0;var f=0;var b=0;var a=0;var e=null;for(b=0;b<FZ.GameDefs.DIAMOND_COL_NUM;b++){for(a=(FZ.GameDefs.DIAMOND_LINE_NUM-1);a>=0;a--){d=a*FZ.GameDefs.DIAMOND_COL_NUM+b;e=this.m_block_show[d];f=this.getLastWhiteLine(b);if((-1===f)||(f<=a)||(null===e)){continue;}d=a*FZ.GameDefs.DIAMOND_COL_NUM+b;c=f*FZ.GameDefs.DIAMOND_COL_NUM+b;this.m_block_show[c]=this.m_block_show[d];this.m_block_show[d]=null;e.setDestLine(f);}}},getFirstWhiteLine:function(c){var a=-1;var b=0;var d=null;b=(0)*FZ.GameDefs.DIAMOND_COL_NUM+c;for(;b<(FZ.GameDefs.DIAMOND_LINE_NUM-1)*FZ.GameDefs.DIAMOND_COL_NUM+c;b+=FZ.GameDefs.DIAMOND_COL_NUM){d=this.m_block_show[b];if(null===d){a=Math.floor(b/FZ.GameDefs.DIAMOND_COL_NUM);break;}}if(a>=FZ.GameDefs.DIAMOND_LINE_NUM){alert("there is an mistake!");}return a;},blockUpMove:function(){var d=0;var c=0;var f=0;var b=0;var a=0;var e=null;for(b=0;b<FZ.GameDefs.DIAMOND_COL_NUM;b++){for(a=0;a<(FZ.GameDefs.DIAMOND_LINE_NUM);a++){d=a*FZ.GameDefs.DIAMOND_COL_NUM+b;e=this.m_block_show[d];f=this.getFirstWhiteLine(b);if((-1===f)||(f>=a)||(null===e)){continue;}d=a*FZ.GameDefs.DIAMOND_COL_NUM+b;c=f*FZ.GameDefs.DIAMOND_COL_NUM+b;this.m_block_show[c]=this.m_block_show[d];this.m_block_show[d]=null;e.setDestLine(f);}}},blockLeftMove:function(){var d=0;var b=0;var a=0;var c=0;a=this.m_centerCol;for(c=(a+1);c<FZ.GameDefs.DIAMOND_COL_NUM;c++){d=this.getBlockNumber(c);if(d>0){this.blockMoveTo(c,a,false);}}},blockRightMove:function(){var d=0;var b=0;var a=0;var c=0;a=this.m_centerCol;for(c=a-1;c>=0;c--){d=this.getBlockNumber(c);if(d>0){this.blockMoveTo(c,a,true);}}},startSearch:function(g,e){var b=null;var f=0;var h=0;var d=(g-FZ.GameDefs.DIAMOND_OFFSET_X);var c=(e-FZ.GameDefs.DIAMOND_OFFSET_Y);var i=Math.floor(c/FZ.GameDefs.GRID_HEIGHT);var a=Math.floor(d/FZ.GameDefs.GRID_WIDTH);if((i<0)||(i>=FZ.GameDefs.DIAMOND_LINE_NUM)||(a<0)||(a>=FZ.GameDefs.DIAMOND_COL_NUM)){this.clearSearchFlag();this.m_last_selected=-1;return this.RESULT_CHANGED;}this.m_hintX=g;this.m_hintY=e;h=i*FZ.GameDefs.DIAMOND_COL_NUM+a;if(h===this.m_last_selected){return this.RESULT_SAME_BLOCK;}this.m_last_selected=h;b=this.m_block_show[h];if(null===b){this.clearSearchFlag();this.m_last_selected=-1;return this.RESULT_CHANGED;}if(FZ.GameDefs.SEARCH_FINISHED===b.getSearchFlag()){return this.RESULT_SAME_BLOCK;}this.clearSearchFlag();this.searchBlockRecursive(h,b.getStyle());f=this.getSameBlockNumber();if(f<FZ.GameDefs.MIN_SAME_DIAMONDS_NUM){this.clearSearchFlag();this.m_last_selected=-1;return this.RESULT_CHANGED;}else{}return this.RESULT_CHANGED;},setFallEffect:function(){var a=this;var c=1;var d=null;var b=0;for(b=0;b<this.m_block_hide.length;b++){d=this.m_block_hide[b];if(null!==d){c+=2;break;}}setTimeout(function(){for(b=0;b<a.m_block_hide.length;b++){d=a.m_block_hide[b];if(null!==d){d.setFallEffect(FZ.GameDefs.FALLING_EFFECT_TIME,c);c+=2;}}},0);setTimeout(function(){a.m_stop_bubble=false;},FZ.GameDefs.FALLING_EFFECT_TIME);},setMoveEffect:function(){var a=this;var c=1;var d=null;var b=0;window.setTimeout(function(){for(b=0;b<a.m_block_show.length;b++){d=a.m_block_show[b];if(null!==d){d.setMoveEffect(FZ.GameDefs.MOVE_EFFECT_TIME,c);c+=2;}}},0);},getFirstLeft:function(){var b=0;var a=0;for(a=0;a<FZ.GameDefs.DIAMOND_COL_NUM;a++){b=this.getBlockNumber(a);if(b>0){return a;}}return -1;},getLastRight:function(){var b=0;var a=0;for(a=FZ.GameDefs.DIAMOND_COL_NUM-1;a>=0;a--){b=this.getBlockNumber(a);if(b>0){return a;}}return -1;},setBlockFalling:function(a,g){var e=0;var d=null;var f=0;var c=0;var b=0;this.startSearch(a,g);e=this.getSameBlockNumber();if(e<FZ.GameDefs.MIN_SAME_DIAMONDS_NUM){this.clearSearchFlag();return;}this.m_get_blocks+=e;this.m_left_block-=e;if(this.m_left_block<0){this.m_left_block=0;}this.m_score+=FZ.GameDefs.BLOCK_SCORE_BASE+FZ.GameDefs.BLOCK_SCORE_UNIT*e*e;for(var b in this.m_block_show){d=this.m_block_show[b];if((null!==d)&&(FZ.GameDefs.SEARCH_FINISHED===d.getSearchFlag())){this.m_block_hide.push(d);this.m_block_show[b]=null;}}f=this.getFirstLeft();c=this.getLastRight();this.blockUpMove();this.m_centerCol=this.getCenterCol(f,c);if(-1!==this.m_centerCol){this.blockRightMove();this.blockLeftMove();}this.setFallEffect();this.setMoveEffect();this.clearSearchFlag();this.m_last_selected=-1;},getNoSearchIndex:function(){var b=null;var a=0;var c=-1;for(a=0;a<(FZ.GameDefs.ALL_DIAMOND_NUM);a++){b=this.m_block_show[a];if(null===b){continue;}if(FZ.GameDefs.SEARCH_NONE===b.getSearchFlag()){c=a;break;}}return c;},getSameBlockNumber:function(){var a=0;var c=0;var b=null;for(a=0;a<this.m_block_show.length;a++){b=this.m_block_show[a];if((null!==b)&&(FZ.GameDefs.SEARCH_FINISHED===b.getSearchFlag())){c+=1;}}return c;},itIsNoWay:function(){var b=null;var a=0;var c=0;var d=0;this.clearSearchFlag();a=this.getNoSearchIndex();while(-1!==a){b=this.m_block_show[a];if(null===b){return -1;}this.searchBlockRecursive(a,b.getStyle());d=this.getSameBlockNumber();if((d-c)>=FZ.GameDefs.MIN_SAME_DIAMONDS_NUM){this.clearSearchFlag();return(-1);}c=d;a=this.getNoSearchIndex();}d=this.getLeftBlock();this.clearSearchFlag();return d;},mouseHandler:function(a){var b=this;a.preventDefault();if(this.m_stop_bubble){return;}this.doAction(a);return false;},doAction:function(c){var g="";var b=0;var h=0;var a=this.RESULT_NONE;var f=null;if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){if(FZ.EVENT_DEF.T_START===c.type){g=FZ.EVENT_DEF.M_MOVE;b=c.touches[0].pageX-FZ.DivManager.getOffsetX();h=c.touches[0].pageY-FZ.DivManager.getOffsetY();this.m_last_x=b;this.m_last_y=h;}else{if(FZ.EVENT_DEF.T_MOVE===c.type){g=FZ.EVENT_DEF.M_MOVE;b=c.touches[0].pageX-FZ.DivManager.getOffsetX();h=c.touches[0].pageY-FZ.DivManager.getOffsetY();this.m_last_x=b;this.m_last_y=h;}else{if(FZ.EVENT_DEF.T_END===c.type){g=FZ.EVENT_DEF.M_CLICK;b=this.m_last_x;h=this.m_last_y;this.m_last_x=0;this.m_last_y=0;}}}}else{b=c.pageX-FZ.DivManager.getOffsetX();h=c.pageY-FZ.DivManager.getOffsetY();g=c.type;}if(FZ.EVENT_DEF.M_MOVE===g){a=this.startSearch(b,h);if(this.RESULT_CHANGED===a){var e=null;for(var d in this.m_block_show){e=this.m_block_show[d];if(null!==e){e.setBlockBack();}}}}else{if(FZ.EVENT_DEF.M_CLICK===g){this.setBlockFalling(b,h);if(this.m_observer){if(this.m_observer.checkOver){this.m_observer.checkOver();}f=new FZ.Evt(FZ.EvtDefs.EVT_UPDATE_UI,this);FZ.EvtManager.sendEvt(f);}}}}});FZ.Shell=FZ.newClass({m_row:0,m_col:0,m_style:0,m_x:0,m_y:0,m_stage:null,m_observer:null,m_div:null,m_img_list:null,__createEle:function(){var c=0;var b=null;var a=null;var d=null;var e=document.createElement("div");e.style.width=FZ.GameDefs.GRID_WIDTH+"px";e.style.height=FZ.GameDefs.GRID_HEIGHT+"px";e.style.position="absolute";e.style.webkitTransition="translate";e.style.backgroundRepeat="no-repeat";for(c=0;c<FZ.GameDefs.BLOCK_STYLE_NUMBER;c++){a=FZ.GameDefs.getInfoByStyle(c).shell;d=FZ.GetImageInfoByName(a);b="url(res/images/"+d.fileURL+")";this.m_img_list.push(b);}e.style.zIndex=10;return e;},init:function(){this.m_img_list=[];this.m_div=this.__createEle();},setRowAndCol:function(b,a){this.m_row=b;this.m_col=a;this.m_x=this.m_col*FZ.GameDefs.GRID_WIDTH+FZ.GameDefs.DIAMOND_OFFSET_X;this.m_y=this.m_row*FZ.GameDefs.GRID_HEIGHT+FZ.GameDefs.DIAMOND_OFFSET_Y;this.setPosition(this.m_x,this.m_y);},setPosition:function(a,b){this.m_div.style.webkitTransitionDuration="0ms";this.m_div.style.webkitTransform="translate("+(a)+"px, "+(b)+"px)";},addToStage:function(a){this.m_stage=a;this.m_stage.appendChild(this.m_div);},setStyle:function(a){this.m_style=a;this.m_div.style.backgroundImage=this.m_img_list[this.m_style];this.show();},changeStyle:function(a){this.setStyle(a);},setObserver:function(a){this.m_observer=a;},removeObserver:function(){this.m_observer=null;},hide:function(){this.m_div.style.webkitTransitionDuration="0ms";this.m_div.style.visibility="hidden";},show:function(){this.m_div.style.visibility="visible";},setMoveTo:function(b,d,a){var c=this;setTimeout(function(){c.m_div.style.webkitTransitionDuration=a+"ms";c.m_div.style.webkitTransform="translate("+(b)+"px, "+(d)+"px)";return true;},50);},destroy:function(){if((this.m_stage)&&this.m_stage.contains(this.m_div)){this.m_stage.removeChild(this.m_div);}}});(function(){var b=function(c,e){var d=0;for(d=0;d<c.length;d++){if(e===c[d].m_style){return true;}}return false;};var a=null;FZ.ShellManager=FZ.newClass({m_parent:null,m_game_shell_list:null,m_ui_shell_list:null,m_observer:null,m_get_shell_time:0,m_get_shell_num:0,__clearArr:function(c){var d=0;for(d=0;d<c.length;d++){c[d].destroy();}c.splice(0,c.length);},init:function(){a=this;this.m_game_shell_list=[];this.m_ui_shell_list=[];this.m_get_shell_time=0;this.m_get_shell_num=0;},setParent:function(c){this.m_parent=c;},setObserver:function(c){this.m_observer=c;},removeObserver:function(){this.m_observer=null;},createGameShell:function(e,f,c){var d=null;if(this.m_game_shell_list.length>0){return;}d=new FZ.Shell();d.setRowAndCol(f,c);d.setStyle(e);this.addGameShell(d);},addGameShell:function(d){var c=-1;c=FZ.ArrayIndexof(this.m_game_shell_list,d);if(-1!==c){return;}d.addToStage(this.m_parent);this.m_game_shell_list.push(d);},removeGameShell:function(c,d){var e=-1;e=FZ.ArrayIndexof(this.m_game_shell_list,c);if(-1!==e){if(d){c.destroy();}this.m_game_shell_list.splice(e,1);}},addShellScore:function(){var c=null;var d=0;d=this.m_get_shell_time;if(d>FZ.GameDefs.SHELL_SCORES.length-1){d=FZ.GameDefs.SHELL_SCORES.length-1;}c=new FZ.ScoreEvt(FZ.EvtDefs.EVT_ADD_SCORE,this,FZ.GameDefs.SHELL_SCORES[d]);FZ.EvtManager.sendEvt(c);this.m_get_shell_time++;this.__clearArr(this.m_ui_shell_list);},addUiShell:function(c){var e=null;var d=false;d=b(this.m_ui_shell_list,c.m_style);if(d){return true;}c.setMoveTo(FZ.GameDefs.UI_SHELLES_POS[this.m_get_shell_num].x,FZ.GameDefs.UI_SHELLES_POS[this.m_get_shell_num].y,1000);this.m_ui_shell_list.push(c);this.m_get_shell_num++;if(this.m_get_shell_num>=FZ.GameDefs.BLOCK_STYLE_NUMBER){this.m_get_shell_num=0;window.setTimeout(function(){a.addShellScore();},2000);}return false;},removeUiShell:function(c){var d=-1;d=FZ.ArrayIndexof(this.m_ui_shell_list,c);if(-1!==d){this.m_ui_shell_list.splice(d,1);}},getGameShellList:function(){return this.m_game_shell_list;},clearGame:function(c){this.__clearArr(this.m_game_shell_list);if(c){this.m_get_shell_time=0;this.m_get_shell_num=0;this.__clearArr(this.m_ui_shell_list);}},update:function(){}});})();FZ.GameManager=FZ.newClass({m_parent:null,m_observer:null,m_block_mgr:null,m_shell_mgr:null,init:function(){this.m_block_mgr=new FZ.BlockManager();this.m_shell_mgr=new FZ.ShellManager();this.m_block_mgr.setObserver(this);this.m_shell_mgr.setObserver(this);},setParent:function(a){this.m_parent=a;this.m_block_mgr.setParent(this.m_parent);this.m_shell_mgr.setParent(this.m_parent);},setObserver:function(a){this.m_observer=a;},removeObserver:function(){this.m_observer=null;},getBlockMgr:function(){return this.m_block_mgr;},getShellMgr:function(){return this.m_shell_mgr;},startGame:function(a){this.m_shell_mgr.clearGame(a);this.m_block_mgr.initAllBlock(a);this.m_block_mgr.setBubble(false);if(FZ.GameDefs.CHEAT_MODE_SHELL===FZ.cheatCode){FZ.CheatCode.setObserver(this);}else{FZ.CheatCode.removeObserver();}},clearGame:function(){this.m_block_mgr.clearGame();},checkGetShell:function(){var b=-1;var c=false;var a=null;var d=null;d=this.m_shell_mgr.getGameShellList();for(index=0;index<d.length;index++){a=d[index];b=this.m_block_mgr.getStyleByCoord(a.m_row,a.m_col);if(-1!==b){a.changeStyle(b);}else{c=this.m_shell_mgr.addUiShell(a);this.m_shell_mgr.removeGameShell(a,c);this.m_block_mgr.addBlocksByShell();}}},checkOver:function(){this.checkGetShell();if(this.m_observer){this.m_observer.checkOver();}},createRandomShell:function(){var a=null;a=this.m_block_mgr.getRandomBlock();if(!a){return;}this.m_shell_mgr.createGameShell(a.style,a.row,a.col);},createGameShell:function(){var b=0;var c=0;var a=0;c=Math.floor(FZ.Math.random(3,FZ.GameDefs.DIAMOND_LINE_NUM-3));a=Math.floor(FZ.Math.random(0,FZ.GameDefs.DIAMOND_COL_NUM));b=this.m_block_mgr.getStyleByCoord(c,a);this.m_shell_mgr.createGameShell(b,c,a);}});(function(){FZ.UIButton=FZ.newClass({SWITCH_ON:0,SWITCH_OFF:1,m_w:0,m_h:0,m_col:1,m_div:null,m_img_list:null,m_call_mOver:null,m_call_mOut:null,m_call_mMove:null,m_call_mClick:null,m_call_tStart:null,m_call_tMove:null,m_call_tEnd:null,m_is_switch:false,m_btn_state:0,m_observer:null,m_enable:true,init:function(a,e,c,b,d){this.m_col=c;this.m_w=a;this.m_h=e;this.m_div=document.createElement("div");this.m_div.style.position="absolute";this.m_div.style.width=this.m_w+"px";this.m_div.style.height=this.m_h+"px";this.m_img_list=[];this.m_img_list.push(b);this.m_img_list.push(d);this.m_div.style.backgroundRepeat="no-repeat";this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[0]+")";this.m_div.style.backgroundPosition="0px 0px";this.m_enable=true;this.m_is_switch=false;this.setEnable(this.m_enable);},setSwitchButton:function(a,b){this.m_is_switch=true;this.m_btn_state=this.SWITCH_ON;this.m_img_list.push(a);this.m_img_list.push(b);},setSwitchState:function(b){var a=0;this.m_btn_state=b;if(this.SWITCH_OFF===this.m_btn_state){a=2;}this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[a+0]+")";},setEnable:function(a){this.m_enable=a;if(this.m_enable){this.addEvent();}else{this.removeEvent();}},setPos:function(a,b){this.m_div.style.left=a+"px";this.m_div.style.top=b+"px";},addEvent:function(){this.removeEvent();if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.T_START,this.mouseHandler);FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.T_MOVE,this.mouseHandler);FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.T_END,this.mouseHandler);}else{FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.M_OVER,this.mouseHandler);FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.M_MOVE,this.mouseHandler);FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.M_OUT,this.mouseHandler);FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.M_CLICK,this.mouseHandler);}},removeEvent:function(){if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.T_START,this.m_call_tStart);this.m_call_tStart=null;FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.T_MOVE,this.m_call_tMove);this.m_call_tMove=null;FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.T_END,this.m_call_tEnd);this.m_call_tEnd=null;}else{FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.M_OVER,this.m_call_mOver);this.m_call_mOver=null;FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.M_OUT,this.m_call_mOut);this.m_call_mOut=null;FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.M_MOVE,this.m_call_mMove);this.m_call_mMove=null;FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.M_CLICK,this.m_call_mClick);this.m_call_mClick=null;}},addMonitor:function(a){this.m_observer=a;},removeMonitor:function(){this.m_observer=null;},mouseHandler:function(a){var c="";var b=0;a.stopPropagation();a.preventDefault();if((this.m_is_switch)&&(this.SWITCH_OFF===this.m_btn_state)){b=2;}if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){if(FZ.EVENT_DEF.T_START===a.type){c=FZ.EVENT_DEF.M_OVER;}if(FZ.EVENT_DEF.T_END===a.type){c=FZ.EVENT_DEF.M_CLICK;}}else{c=a.type;}if(FZ.EVENT_DEF.M_OVER===c){this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[b+1]+")";}else{if(FZ.EVENT_DEF.M_OUT===c){this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[b+0]+")";}else{if(FZ.EVENT_DEF.M_CLICK===c){this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[b+0]+")";if((null!==this.m_observer)&&(this.m_observer.buttonClick)){this.m_observer.buttonClick(this);}}}}return false;}});})();(function(){FZ.UISwitch=FZ.newClass({m_w:0,m_h:0,m_col:1,m_div:null,m_img_list:null,m_call_mClick:null,m_call_tEnd:null,m_observer:null,m_state:0,init:function(a,c,b,e,d){this.m_col=b;this.m_w=a;this.m_h=c;this.m_div=document.createElement("div");this.m_div.style.position="absolute";this.m_div.style.width=this.m_w+"px";this.m_div.style.height=this.m_h+"px";this.m_img_list=[];this.m_img_list.push(e);this.m_img_list.push(d);this.m_div.style.backgroundRepeat="no-repeat";this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[0]+")";this.m_div.style.backgroundPosition="0px 0px";this.m_state=FZ.GameDefs.SWITCH_ON;this.addEvent();},getState:function(){return this.m_state;},setState:function(b){var a=0;this.m_state=b;if(FZ.GameDefs.SWITCH_OFF===this.m_state){a=1;}this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[a]+")";},switchState:function(c){var b=0;var a=null;if(FZ.GameDefs.SWITCH_OFF==this.m_state){this.m_state=FZ.GameDefs.SWITCH_ON;}else{this.m_state=FZ.GameDefs.SWITCH_OFF;b=1;}this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[b]+")";a=new FZ.Evt(FZ.EvtDefs.EVT_SWT_CLICK,this);FZ.EvtManager.sendEvt(a);},setPos:function(a,b){this.m_div.style.left=a+"px";this.m_div.style.top=b+"px";},addEvent:function(){this.removeEvent();if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.T_MOVE,this.mouseHandler);FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.T_END,this.mouseHandler);}else{FZ.EventHandler(this,this.m_div,FZ.EVENT_DEF.M_CLICK,this.mouseHandler);}},removeEvent:function(){if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.T_END,this.m_call_tEnd);this.m_call_tEnd=null;}else{FZ.EventRemove(this,this.m_div,FZ.EVENT_DEF.M_CLICK,this.m_call_mClick);this.m_call_mClick=null;}},mouseHandler:function(a){var b="";a.stopPropagation();a.preventDefault();if(FZ.EVENT_DEF.M_OVER===b){this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[index+1]+")";}else{if(FZ.EVENT_DEF.M_OUT===b){this.m_div.style.backgroundImage="url(res/images/"+this.m_img_list[index+0]+")";}else{if(FZ.EVENT_DEF.M_CLICK===b){}}}this.switchState();return false;}});})();(function(){FZ.UIMenu=FZ.newClass({MENU_SHOW:0,MENU_HIDE:1,m_div:null,m_back_div:null,m_btn_list:null,m_back_w:0,m_back_h:0,m_observer:null,m_state:0,m_show_x:0,m_show_y:0,m_hide_x:0,m_hide_y:0,m_btn_enable:null,init:function(){this.m_div=document.createElement("div");this.m_div.style.position="absolute";this.m_div.style.webkitTransition="translate";this.m_btn_list=[];this.m_back_div=document.createElement("div");this.setState(this.MENU_SHOW,0);},setBackImage:function(c,b,e,d){var a=null;if(undefined!==b){this.m_back_w=b;}if(undefined!==e){this.m_back_h=e;}this.m_div.style.position="absolute";this.m_div.style.width=this.m_back_w+"px";this.m_div.style.height=this.m_back_h+"px";this.m_back_div.style.width=d.w+"px";this.m_back_div.style.height=d.h+"px";this.m_back_div.style.position="absolute";this.m_back_div.style.backgroundRepeat="no-repeat";this.m_back_div.style.backgroundImage="url(res/images/"+c+")";this.m_back_div.style.left=d.x+"px";this.m_back_div.style.top=d.y+"px";this.m_div.appendChild(this.m_back_div);},setzIndex:function(a){this.m_div.style.zIndex=a;},setOffset:function(a,b){this.m_offsetx=a;this.m_offsety=b;this.m_div.style.left=this.m_offsetx+"px";this.m_div.style.top=this.m_offsety+"px";},setPos:function(a,b){this.m_div.style.webkitTransitionDuration="0.2s";this.m_div.style.webkitTransform="translate("+(a)+"px, "+(b)+"px)";},setShowPos:function(a,b){this.m_show_x=a;this.m_show_y=b;},setHidePos:function(a,b){this.m_hide_x=a;this.m_hide_y=b;},addMonitor:function(a){this.m_observer=a;},removeMonitor:function(){this.m_observer=null;},setEnableBtn:function(a){this.m_btn_enable=a;a.m_div.style.zIndex=1;},addButton:function(a){this.m_div.appendChild(a.m_div);this.m_btn_list.push(a);},addEnableBtn:function(){switch(this.m_state){case this.MENU_SHOW:if(this.m_btn_enable){this.m_btn_enable.setSwitchState(this.m_btn_enable.SWITCH_OFF);}break;case this.MENU_HIDE:if(this.m_btn_enable){this.m_btn_enable.setSwitchState(this.m_btn_enable.SWITCH_ON);}break;default:break;}},setState:function(a,b){this.m_state=a;switch(this.m_state){case this.MENU_SHOW:this.setPos(this.m_show_x,this.m_show_y);break;case this.MENU_HIDE:this.setPos(this.m_hide_x,this.m_hide_y);break;default:break;}this.addEnableBtn();},removeButton:function(c){var a=-1;var b=0;for(b=0;b<this.m_btn_list.length;b++){if(c===this.m_btn_list[b]){a=b;break;}}if(-1!==a){c.removeEvent();c.removeMonitor();this.m_btn_list.splice(a,1);}},addEvent:function(){var a=0;var b=null;for(a=0;a<this.m_btn_list.length;a++){b=this.m_btn_list[a];b.addMonitor(this);b.setEnable(true);}},removeEvent:function(c){var a=0;var b=null;for(a=0;a<this.m_btn_list.length;a++){b=this.m_btn_list[a];b.removeMonitor();b.setEnable(false);}},buttonClick:function(a){if((null!==this.m_observer)&&(this.m_observer.menuItemClick)){this.m_observer.menuItemClick(a);}}});})();(function(){FZ.CheatCode=new (FZ.newClass({SHELL_TOUCH_AREA:[10,320,80,80],CHEAT_CODE_DEF:[0,0,0,1,1,1],CHEAT_CODE_STR:["show me the shell","whosyourdaddy"],m_observer:null,init:function(){},reset:function(){this.__clearCode();},setObserver:function(a){this.m_observer=a;},removeObserver:function(){this.m_observer=null;},isCheatCode:function(b,a){if(!b){return false;}b=b.toLowerCase();if(b===a){return true;}return false;},checkTouch:function(a){if(!FZ.ControlManager.Mouse.mouseUp){return false;}if(FZ.ControlManager.Mouse.x>=a[0]&&FZ.ControlManager.Mouse.y>=a[1]&&FZ.ControlManager.Mouse.x<=a[0]+a[2]&&FZ.ControlManager.Mouse.y<=a[1]+a[3]){return true;}return false;},addShell:function(){if(FZ.GameDefs.CHEAT_MODE_SHELL!==FZ.cheatCode){return;}if((this.m_observer)&&(this.m_observer.createRandomShell)){this.m_observer.createRandomShell();}},checkCheat:function(a){var b=0;if(!a){return;}if(a.length!==this.CHEAT_CODE_DEF.length){return;}for(b=0;b<this.CHEAT_CODE_DEF.length;b++){if(a[b]!==this.CHEAT_CODE_DEF[b]){return;}}if(this.m_observer){if(this.m_observer.setCheatCode){this.m_observer.setCheatCode();}}}}));})();(function(){FZ.HelpInterface=new (FZ.newClass({BG_EMPTY:0,BG_COLOR:1,UI_DEFS:["uiHelp","uiMainHelp"],BTN_DEFS:[["btnHelpBack","btnHelpBack_over"]],m_ui_index:0,m_main_div:null,m_ui_list:null,m_btn_list:null,m_uiCreated:false,m_parent:null,__createUIs:function(d){var b=0;var c=null;var e=null;var a=null;if(!d){return;}a=[];for(b=0;b<d.length;b++){c=FZ.GetImageInfoByName(d[b]);e=document.createElement("div");FZ.GameBase.setCss(e,c);a.push(e);this.m_main_div.appendChild(e);}return a;},__createBtns:function(d){var b=0;var c=null;var e=null;var a=null;a=[];for(b=0;b<d.length;b++){c=FZ.GetImageInfoByName(d[b][0]);e=FZ.GetImageInfoByName(d[b][1]);btn=new FZ.UIButton(c.w,c.h,c.cols,c.fileURL,e.fileURL);btn.setPos(c.x,c.y);btn.addMonitor(this);a.push(btn);this.m_main_div.appendChild(btn.m_div);}return a;},__createBg:function(){var a=null;this.m_main_div=document.createElement("div");this.m_main_div.style.position="absolute";this.m_main_div.style.width=FZ.GameDefs.SCREEN_W+"px";this.m_main_div.style.height=FZ.GameDefs.SCREEN_H+"px";this.m_main_div.zIndex=10;return a;},init:function(){this.m_parent=null;this.m_uiCreated=false;},__createUis:function(){if(this.m_uiCreated){return;}this.m_uiCreated=true;this.__createBg();this.m_ui_list=this.__createUIs(this.UI_DEFS);this.m_btn_list=this.__createBtns(this.BTN_DEFS);},__setBg:function(b){var a=0;for(a=0;a<this.m_ui_list.length;a++){if(a===b){this.m_ui_list[a].style.visibility="visible";}else{this.m_ui_list[a].style.visibility="hidden";}}},addToStage:function(b,a){this.__createUis();this.__setBg(a);this.m_parent=b;b.appendChild(this.m_main_div);},removeFromStage:function(){if((this.m_parent)&&(this.m_parent.contains(this.m_main_div))){this.m_parent.removeChild(this.m_main_div);}this.m_parent=null;},getDiv:function(){return this.m_main_div;},buttonClick:function(b){var a=null;if(b===this.m_btn_list[0]){evt=new FZ.Evt(FZ.EvtDefs.EVT_HELP_BACK,this);FZ.EvtManager.sendEvt(evt);}}}));})();(function(){var a=null;FZ.ClearInterface=new (FZ.newClass({UI_DEFS:["uiLevelClear"],m_main_div:null,m_ui_list:null,m_btn_list:null,m_uiCreated:false,m_parent:null,m_x:0,m_y:0,__createUIs:function(e){var c=0;var d=null;var f=null;var b=null;b=[];for(c=0;c<e.length;c++){d=FZ.GetImageInfoByName(e[c]);f=document.createElement("div");FZ.GameBase.setCss(f,d);b.push(f);this.m_main_div.appendChild(f);}return b;},__createBg:function(){var b=null;this.m_main_div=document.createElement("div");this.m_main_div.style.position="absolute";this.m_main_div.style.width=FZ.GameDefs.SCREEN_W+"px";this.m_main_div.style.height=FZ.GameDefs.SCREEN_H+"px";this.m_main_div.style.webkitTransition="translate";this.m_main_div.zIndex=10;return b;},init:function(){a=this;this.m_parent=null;this.m_uiCreated=false;this.m_x=FZ.GameDefs.SCREEN_W;this.m_y=0;},__createUis:function(){if(this.m_uiCreated){return;}this.m_uiCreated=true;this.__createBg();this.m_ui_list=this.__createUIs(this.UI_DEFS);},addToStage:function(c,b){this.__createUis();this.m_parent=c;c.appendChild(this.m_main_div);setTimeout(function(){a.removeFromStage();return true;},b);},removeFromStage:function(){if((this.m_parent)&&(this.m_parent.contains(this.m_main_div))){this.m_parent.removeChild(this.m_main_div);}this.m_parent=null;},reset:function(){},moveLeft:function(b){}}));})();FZ.Game.LogoState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_LOGO,CUR_UI_DEFS:["SpilSplash"],m_test_timer:0,preProcess:function(){var a=this;this.m_main_div.style.webkitTransition="opacity";this.m_main_div.style.backgroundColor="#fff";this.m_main_div.style.width=FZ.GameDefs.SCREEN_W+"px";this.m_main_div.style.height=FZ.GameDefs.SCREEN_H+"px";this.m_main_div.style.webkitTransitionDuration="0s";this.m_main_div.style.opacity=0;this.createUIs(this.CUR_UI_DEFS);FZ.DivManager.addChild(this.m_main_div);this.m_timer=setTimeout(FZ.Tools.bind(this,this.fade_in),10);this.resetTranslate(0);setTimeout(function(){a.fade_in.call(a,2000,1);},10);},postProcess:function(){FZ.DivManager.removeChild(this.m_main_div);clearTimeout(this.m_timer);},fade_in:function(){this.m_main_div.style.webkitTransitionDuration="1s";this.m_main_div.style.opacity=1;this.m_timer=setTimeout(FZ.Tools.bind(this,this.fade_out),3000);},fade_out:function(){this.m_main_div.style.webkitTransitionDuration="1s";this.m_main_div.style.opacity=0;this.m_timer=setTimeout(FZ.Tools.bind(this,this.fade_end),1000);},fade_end:function(){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_LOADING);},AIUpdate:function(a){}},FZ.BaseState))();FZ.Game.LoadingState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_LOADING,CUR_UI_DEFS:["loading_bg","loading_bar","loading_box"],m_test_timer:0,m_bar_w:0,m_bar_div:null,preProcess:function(){var a=this;var d=null;var b=0;var c=null;this.createUIs(this.CUR_UI_DEFS);c=FZ.GetImageInfoByName(this.CUR_UI_DEFS[1]);this.m_bar_w=c.w;this.m_bar_div=this.m_ui_list[1];this.m_bar_div.style.overflow="hidden";this.m_bar_div.style.backgroundPosition=""+(0-this.m_bar_w)+"px 0px";for(b=0;b<FZ.ImageConfig.length;b++){c=FZ.ImageConfig[b];FZ.spriteManager.addResource(c.name,c.zOrder,"res/images/"+c.fileURL,c.x,c.y,c.cols);}FZ.ResourceManager.addResource({Name:FZ.GameDefs.SND_BG,Type:"Audio",URL:FZ.GameDefs.SND_DEF});FZ.DivManager.addChild(this.m_main_div);this.resetTranslate(0);setTimeout(function(){a.fade_in.call(a,2000,1);},10);this.m_timer=setTimeout(FZ.Tools.bind(this,this.AIUpdate),100);},postProcess:function(){FZ.DivManager.removeChild(this.m_main_div);clearTimeout(this.m_timer);},AIUpdate:function(b){var a=null;var c=0;this.m_timer=setTimeout(FZ.Tools.bind(this,this.AIUpdate),200);if(0!==FZ.ResourceManager.__ResourceCount){c=this.m_bar_w*FZ.ResourceManager.__ResourceLoaded/FZ.ResourceManager.__ResourceCount;}c=c-this.m_bar_w;this.m_bar_div.style.backgroundPosition=""+c+"px 0px";if(FZ.ResourceManager.isResourceLoaded()){a=FZ.ResourceManager.getResource(FZ.GameDefs.SND_BG);FZ.Music.set(a,true);FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_MAINMEN);}}},FZ.BaseState))();FZ.Game.MainmenuState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_MAINMEN,CUR_UI_DEFS:["uiMainBg"],BTN_PLAY_INDEX:0,BTN_HELP_INDEX:1,CUR_BTN_DEFS:[["btnStart","btnStart_over"],["btnHelp","btnHelp_over"]],SWT_SND_IDNEX:0,SWT_DEFS:[["btnSound","btnSound_over"]],HELP_DEFS:["uiHelp"],m_swt_list:null,m_load_ui:false,m_txt_score:null,m_pause:false,__setPause:function(a){this.m_pause=a;},__createLabels:function(){this.m_txt_score=FZ.CreateTextDiv(FZ.GameDefs.TXT_MAIN_SCORE[0],FZ.GameDefs.TXT_MAIN_SCORE[1],FZ.GameDefs.TXT_MAIN_SCORE[2],FZ.GameDefs.TXT_MAIN_SCORE[3],"#ffffff");this.m_main_div.appendChild(this.m_txt_score);},__updateScore:function(){this.m_txt_score.innerHTML=""+FZ.GameBase.SaveObject.bestScore;},preProcess:function(){var c=0;var d=null;var e=null;var f=null;var a=null;var b=this;if(!this.m_load_ui){this.createUIs(this.CUR_UI_DEFS);this.createBtns(this.CUR_BTN_DEFS,true);this.m_swt_list=this.createSwitches(this.SWT_DEFS,true);this.__createLabels();FZ.DivManager.addChild(this.m_main_div);FZ.Music.setMute(FZ.GameBase.SaveObject.mute);this.m_load_ui=true;}else{this.m_main_div.style.display="block";}this.resetTranslate(0.5);this.__updateScore();setTimeout(function(){b.fade_in.call(b,2000,1);},10);if(FZ.GameBase.SaveObject.mute){this.m_swt_list[this.SWT_SND_IDNEX].setState(FZ.GameDefs.SWITCH_OFF);}else{this.m_swt_list[this.SWT_SND_IDNEX].setState(FZ.GameDefs.SWITCH_ON);}FZ.CheatCode.setObserver(this);FZ.EvtManager.addListener(this,FZ.EvtDefs.EVT_SWT_CLICK,this.switchHandler);},postProcess:function(){this.fade_out(2000,0,0);FZ.EvtManager.removeListener(FZ.EvtDefs.EVT_SWT_CLICK,this.switchHandler);},buttonClick:function(b){var a=this;if(a.m_btn_list[a.BTN_PLAY_INDEX]===b){FZ.CheatCode.removeObserver();FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_GAME_IN);}else{if(a.m_btn_list[a.BTN_HELP_INDEX]===b){this.__setPause(true);FZ.HelpInterface.addToStage(this.m_main_div,FZ.HelpInterface.BG_COLOR);FZ.EvtManager.addListener(this,FZ.EvtDefs.EVT_HELP_BACK,this.helpHandler);}}},setCheatCode:function(){var a=false;var b=null;if(FZ.GameDefs.CHEAT_MODE_NONE!==FZ.cheatCode){FZ.cheatCode=FZ.GameDefs.CHEAT_MODE_NONE;alert(FZ.GameDefs.CHEAT_MSG_DISABLE);return;}b=prompt(FZ.GameDefs.CHEAT_MSG_PROMPT);if(FZ.CheatCode.isCheatCode(b,FZ.CheatCode.CHEAT_CODE_STR[0])){FZ.cheatCode=FZ.GameDefs.CHEAT_MODE_SHELL;alert(FZ.GameDefs.CHEAT_MSG_SHELL);}else{if(FZ.CheatCode.isCheatCode(b,FZ.CheatCode.CHEAT_CODE_STR[1])){FZ.cheatCode=FZ.GameDefs.CHEAT_MODE_INVINCIBLE;alert(FZ.GameDefs.CHEAT_MSG_INVINCIBLE);}}},switchHandler:function(a){var b=a.getTarget();if(FZ.GameDefs.SWITCH_ON===b.getState()){FZ.GameBase.SaveObject.mute=false;}else{FZ.GameBase.SaveObject.mute=true;}FZ.GameBase.saveGame();FZ.Music.setMute(FZ.GameBase.SaveObject.mute);},helpHandler:function(a){var b=a.getType();if(FZ.EvtDefs.EVT_HELP_BACK===b){this.__setPause(false);FZ.HelpInterface.removeFromStage();FZ.EvtManager.removeListener(FZ.EvtDefs.EVT_HELP_BACK,this.helpHandler);}}},FZ.BaseState))();FZ.Game.HowToPlayState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_HOW_TO_PLAY,CUR_UI_DEFS:["common_background","ui_how_to_play",],BTN_BACK_INDEX:0,CUR_BTN_DEFS:["btn_back"],m_load_ui:false,preProcess:function(){var a=0;var c=null;var b=null;if(!this.m_load_ui){this.createUIs(this.CUR_UI_DEFS);this.createBtns(this.CUR_BTN_DEFS,true);FZ.DivManager.addChild(this.m_main_div);this.m_load_ui=true;}else{FZ.DivManager.addChild(this.m_main_div);}},postProcess:function(){FZ.DivManager.removeChild(this.m_main_div);},buttonClick:function(a){if(this.m_btn_list[this.BTN_BACK_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_MAINMEN);}}},FZ.BaseState))();(function(){FZ.Game.GameState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_GAME_IN,CUR_UI_DEFS:["uiGameBg"],BTN_ARROW_INDEX:0,BTN_NEW_GAME_INDEX:1,BTN_HELP_INDEX:2,BTN_RETURN_INDEX:3,CUR_BTN_DEFS:[["btnPopMenu","btnPopMenu_over"],["btnPopNew","btnPopNew_over"],["btnPopHelp","btnPopHelp_over"],["btnPopQuit","btnPopQuit_over"]],CUR_SWITCH_DEFS:["btnPopBack","btnPopBack_over"],CUR_SLIDE_MENU:["menu_bg"],HELP_DEFS:["uiMainHelp"],LABEL_LEVEL_INDEX:0,LABEL_LEFT_INDEX:1,LABEL_SCORE_INDEX:2,CUR_LABLE_DEFS_REF:[],m_label_list:null,SPR_NEXT_INDEX:0,SPR_LIST:["anim_next_level"],m_next_spr:null,m_show_next_start:0,m_gameMgr:null,m_diamondMgr:null,m_load_ui:false,m_start_time:0,m_is_pause:false,m_slide_menu:null,m_help:false,pause:function(){this.saveTime();},__setHelp:function(a){this.m_help=a;},preProcess:function(e){var c=0;var a=null;var h=null;var f=null;var d=null;var g=null;var b=this;if(!this.m_load_ui){this.createUIs(this.CUR_UI_DEFS);this.createSlideMenu();this.createLabels();this.m_gameMgr=new FZ.GameManager();this.m_gameMgr.setParent(this.m_main_div);this.m_diamondMgr=this.m_gameMgr.getBlockMgr();FZ.DivManager.addChild(this.m_main_div);this.m_load_ui=true;}else{this.m_slide_menu.setState(this.m_slide_menu.MENU_HIDE,0);}this.m_gameMgr.setObserver(this);if((FZ.StateDefs.GAME_STATE_OVER==e)||(FZ.StateDefs.GAME_STATE_MAINMEN==e)){this.m_gameMgr.clearGame();this.m_gameMgr.startGame(true);}this.m_diamondMgr.setBubble(false);this.m_start_time=(new Date()).getTime();this.resetTranslate(0);setTimeout(function(){b.fade_in.call(b,2000,1);},10);FZ.EvtManager.addListener(this,FZ.EvtDefs.EVT_UPDATE_UI,this.updateLabel);this.updateLabel(null);},postProcess:function(){this.fade_out(2000,0,0);FZ.EvtManager.removeListener(FZ.EvtDefs.EVT_UPDATE_UI,this.updateLabel);},createSlideMenu:function(){var d=null;var c=null;var b=0;var a=0;if(FZ.TARGET_DEF.ANDROID===FZ.TargetMobile){a=FZ.GameDefs.ANDRIOD_OFFSETY;}this.createBtns(this.CUR_BTN_DEFS,false);d=FZ.GetImageInfoByName(this.CUR_SLIDE_MENU[0]);this.m_slide_menu=new FZ.UIMenu();this.m_slide_menu.setPos(FZ.GameDefs.POP_MENU_OFFSETX,FZ.GameDefs.POP_MENU_OFFSETY+a);this.m_slide_menu.setBackImage(d.fileURL,FZ.GameDefs.POP_MENU_W,FZ.GameDefs.POP_MENU_H,d);this.m_slide_menu.setzIndex(2);this.m_slide_menu.setShowPos(FZ.GameDefs.POP_MENU_OFFSETX,FZ.GameDefs.POP_MENU_OFFSETY+FZ.GameDefs.SHOW_HIDE_OFFSETY+a);this.m_slide_menu.setHidePos(FZ.GameDefs.POP_MENU_OFFSETX,FZ.GameDefs.POP_MENU_OFFSETY+a);for(b=0;b<this.m_btn_list.length;b++){this.m_slide_menu.addButton(this.m_btn_list[b]);if(0===b){this.m_slide_menu.setEnableBtn(this.m_btn_list[b]);}}d=FZ.GetImageInfoByName(this.CUR_SWITCH_DEFS[0]);c=FZ.GetImageInfoByName(this.CUR_SWITCH_DEFS[1]);this.m_slide_menu.m_btn_enable.setSwitchButton(d.fileURL,c.fileURL);this.m_slide_menu.addEvent();this.m_slide_menu.setState(this.m_slide_menu.MENU_HIDE,0);this.m_slide_menu.addMonitor(this);this.m_main_div.appendChild(this.m_slide_menu.m_div);},createLabels:function(){var a=0;if(this.m_label_list){this.m_label_list.splice(0,this.m_label_list.length);}else{this.m_label_list=[];}this.m_label_list[this.LABEL_LEVEL_INDEX]=FZ.CreateTextDiv(FZ.GameDefs.TXT_GAMEIN_LEVEL[0],FZ.GameDefs.TXT_GAMEIN_LEVEL[1],FZ.GameDefs.TXT_GAMEIN_LEVEL[2],FZ.GameDefs.TXT_GAMEIN_LEVEL[3],"#ffffff");this.m_label_list[this.LABEL_LEFT_INDEX]=FZ.CreateTextDiv(FZ.GameDefs.TXT_GAMEIN_BLOCK[0],FZ.GameDefs.TXT_GAMEIN_BLOCK[1],FZ.GameDefs.TXT_GAMEIN_BLOCK[2],FZ.GameDefs.TXT_GAMEIN_BLOCK[3],"#ffffff");this.m_label_list[this.LABEL_SCORE_INDEX]=FZ.CreateTextDiv(FZ.GameDefs.TXT_GAMEIN_SCORE[0],FZ.GameDefs.TXT_GAMEIN_SCORE[1],FZ.GameDefs.TXT_GAMEIN_SCORE[2],FZ.GameDefs.TXT_GAMEIN_SCORE[3],"#ffffff");for(a=0;a<this.m_label_list.length;a++){this.m_main_div.appendChild(this.m_label_list[a]);}},saveTime:function(){},checkOver:function(){var b=0;var a=this.m_diamondMgr.getLeftNumber();if(-1!==a){if(this.m_diamondMgr.getCurLevel()>=FZ.GameDefs.MAX_LEVEL){setTimeout(FZ.Tools.bind(this,this.setComplete),FZ.GameDefs.GAME_CLEAR_TIME);}if((this.m_diamondMgr.getGetBlocks()>=FZ.GameDefs.LEVEL_LEFT_BLOCK[this.m_diamondMgr.getCurLevel()])||(FZ.GameDefs.CHEAT_MODE_INVINCIBLE===FZ.cheatCode)){this.m_diamondMgr.setBubble(true);FZ.ClearInterface.addToStage(this.m_main_div,FZ.GameDefs.GAME_CLEAR_TIME);setTimeout(FZ.Tools.bind(this,this.setNextLevel),FZ.GameDefs.GAME_CLEAR_TIME);}else{this.m_diamondMgr.setBubble(true);setTimeout(FZ.Tools.bind(this,this.setGameOver),FZ.GameDefs.GAME_CLEAR_TIME);}}FZ.curGameScore=this.m_diamondMgr.getScore();if(FZ.curGameScore>FZ.GameBase.SaveObject.bestScore){FZ.GameBase.SaveObject.bestScore=FZ.curGameScore;FZ.GameBase.saveGame();}},setGameOver:function(){this.m_diamondMgr.setBubble(false);FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_OVER,this.m_diamondMgr.getScore());},setComplete:function(){this.m_diamondMgr.setBubble(false);FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_COMPLETE,this.m_diamondMgr.getScore());},setNextLevel:function(){this.m_diamondMgr.setBubble(false);this.m_gameMgr.clearGame();this.m_gameMgr.startGame(false);},gamekeyup:function(a){},menuItemClick:function(a){if(this.m_help){return;}if(this.m_btn_list[this.BTN_ARROW_INDEX]===a){if(this.m_slide_menu.MENU_HIDE===this.m_slide_menu.m_state){this.m_slide_menu.setState(this.m_slide_menu.MENU_SHOW,0.5);this.m_diamondMgr.setBubble(true);}else{this.m_slide_menu.setState(this.m_slide_menu.MENU_HIDE,0.5);this.m_diamondMgr.setBubble(false);}}else{if(this.m_btn_list[this.BTN_NEW_GAME_INDEX]===a){this.m_gameMgr.clearGame();this.m_gameMgr.startGame(true);this.m_slide_menu.setState(this.m_slide_menu.MENU_HIDE,0.5);this.m_diamondMgr.setBubble(false);}else{if(this.m_btn_list[this.BTN_HELP_INDEX]===a){this.__setHelp(true);FZ.HelpInterface.addToStage(this.m_main_div,FZ.HelpInterface.BG_EMPTY);FZ.EvtManager.addListener(this,FZ.EvtDefs.EVT_HELP_BACK,this.helpHandler);this.m_slide_menu.setState(this.m_slide_menu.MENU_HIDE,0.5);this.m_diamondMgr.setBubble(true);}else{if(this.m_btn_list[this.BTN_RETURN_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_MAINMEN);}}}}},updateLabel:function(a){var b=null;if(!a){b=this.m_diamondMgr;}else{b=a.getTarget();}this.m_label_list[this.LABEL_LEVEL_INDEX].innerHTML=""+(b.getCurLevel()+1);this.m_label_list[this.LABEL_SCORE_INDEX].innerHTML=""+b.getScore();this.m_label_list[this.LABEL_LEFT_INDEX].innerHTML=""+b.getLeftBlocks();},helpHandler:function(a){var b=a.getType();if(FZ.EvtDefs.EVT_HELP_BACK===b){this.m_diamondMgr.setBubble(false);this.__setHelp(false);FZ.HelpInterface.removeFromStage();FZ.EvtManager.removeListener(FZ.EvtDefs.EVT_HELP_BACK,this.helpHandler);}}},FZ.BaseState))();})();FZ.Game.GameOverState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_OVER,CUR_UI_DEFS:["uiAllBg","uiFailed"],BTN_NEW_INDEX:0,BTN_NO_INDEX:1,CUR_BTN_DEFS:[["btnOverRestart","btnOverRestart_over"],["btnOverGoMenu","btnOverGoMenu_over"]],STR_RECT:[162,184,138,36],m_last_score_div:null,m_load_ui:false,m_txt_score:null,__createLabels:function(){this.m_txt_score=FZ.CreateTextDiv(FZ.GameDefs.TXT_GAME_OVER_SCORE[0],FZ.GameDefs.TXT_GAME_OVER_SCORE[1],FZ.GameDefs.TXT_GAME_OVER_SCORE[2],FZ.GameDefs.TXT_GAME_OVER_SCORE[3],"#ffffff");this.m_main_div.appendChild(this.m_txt_score);},__updateScore:function(){this.m_txt_score.innerHTML=""+FZ.curGameScore;},preProcess:function(g,f,d){var c=this;var e=0;var a=null;var b=null;var h=null;var i=null;if(!this.m_load_ui){this.createUIs(this.CUR_UI_DEFS);this.createBtns(this.CUR_BTN_DEFS,true);this.__createLabels();FZ.DivManager.addChild(this.m_main_div);this.m_load_ui=true;}else{}this.__updateScore();this.resetTranslate(0);setTimeout(function(){c.fade_in.call(c,2000,1);},10);},postProcess:function(){this.fade_out(2000,0,0);},buttonClick:function(a){var b=null;if(this.m_btn_list[this.BTN_NEW_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_GAME_IN);}else{if(this.m_btn_list[this.BTN_NO_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_MAINMEN);}}}},FZ.BaseState))();FZ.Game.CompleteState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_COMPLETE,CUR_UI_DEFS:["uiAllBg","uiComplete"],BTN_NEW_INDEX:0,BTN_NO_INDEX:1,CUR_BTN_DEFS:[["btnCompleteRestart","btnCompleteRestart_over"],["btnCompleteGoMenu","btnCompleteGoMenu_over"]],STR_RECT:[162,184,138,36],m_last_score_div:null,m_load_ui:false,m_txt_score:null,__createLabels:function(){this.m_txt_score=FZ.CreateTextDiv(FZ.GameDefs.TXT_GAME_COMPLETE_SCORE[0],FZ.GameDefs.TXT_GAME_COMPLETE_SCORE[1],FZ.GameDefs.TXT_GAME_COMPLETE_SCORE[2],FZ.GameDefs.TXT_GAME_COMPLETE_SCORE[3],"#ffffff");this.m_main_div.appendChild(this.m_txt_score);},__updateScore:function(){this.m_txt_score.innerHTML=""+FZ.curGameScore;},preProcess:function(g,f,d){var c=this;var e=0;var a=null;var b=null;var h=null;var i=null;if(!this.m_load_ui){this.createUIs(this.CUR_UI_DEFS);this.createBtns(this.CUR_BTN_DEFS,true);this.__createLabels();FZ.DivManager.addChild(this.m_main_div);this.m_load_ui=true;}else{}this.__updateScore();this.resetTranslate(0);setTimeout(function(){c.fade_in.call(c,2000,1);},10);},postProcess:function(){this.fade_out(2000,0,0);},buttonClick:function(a){var b=null;if(this.m_btn_list[this.BTN_NEW_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_GAME_IN);}else{if(this.m_btn_list[this.BTN_NO_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_MAINMEN);}}}},FZ.BaseState))();FZ.Game.StatisticsState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_STATS,CUR_UI_DEFS:["GAME_BG","LABEL_ICON_BEST_SCORE","LABEL_ICON_CLEARED","LABEL_ICON_NOT_CLEARED","LABEL_ICON_TIME_PLAYED","LABEL_ICON_WIN"],LABEL_CLEARED_INDEX:0,LABEL_NOT_CLEARED_INDEX:1,LABEL_WIN_INDEX:2,LABEL_BEST_INDEX:3,LABEL_TIME_PLAYED_INDEX:4,CUR_LABEL_BG_REF_DEFS:["LABEL_ICON_CLEARED","LABEL_ICON_NOT_CLEARED","LABEL_ICON_WIN","LABEL_ICON_BEST_SCORE","LABEL_ICON_TIME_PLAYED"],CUR_LABEL_BOX:"LABEL_ICON_BOX",BTN_RESET_INDEX:0,BTN_RETURN_INDEX:1,CUR_BTN_DEFS:[["BTN_MENU_TRASH","BTN_MENU_TRASH_LIGHT"],["BTN_MENU_RETURN","BTN_MENU_RETURN_LIGHT"]],m_label_list:null,m_label_bg_list:null,m_load_ui:false,preProcess:function(){var b=this;var c=0;var d=null;var e=null;var f=null;var a=null;if(!this.m_load_ui){this.createUIs(this.CUR_UI_DEFS);this.createBtns(this.CUR_BTN_DEFS,true);this.createBg();this.createLabelStrings();FZ.DivManager.addChild(this.m_main_div);this.m_load_ui=true;}else{}this.setLabelContext();this.resetTranslate(0);setTimeout(function(){b.fade_in.call(b,2000,1);},10);},createBg:function(){var b=0;var a=null;var d=null;var c=null;this.m_label_list=[];this.m_label_bg_list=[];for(b=0;b<this.CUR_LABEL_BG_REF_DEFS.length;b++){d=FZ.GetImageInfoByName(this.CUR_LABEL_BOX);c={};c.x=d.x;c.y=d.y+b*60;c.w=d.w;c.h=d.h;c.fileURL=d.fileURL;a=document.createElement("div");FZ.GameBase.setCss(a,c);this.m_label_bg_list.push(a);this.m_main_div.appendChild(a);}},createLabelStrings:function(){var b=0;var a=null;var d=null;var c=null;for(b=0;b<this.CUR_LABEL_BG_REF_DEFS.length;b++){d=FZ.GetImageInfoByName(this.CUR_LABEL_BOX);c={};c.x=d.x;c.y=d.y+b*60;c.w=d.w;c.h=d.h;c.fileURL=d.fileURL;a=document.createElement("div");a.style.position="absolute";a.style.width=c.w+"px";a.style.height=c.h+"px";a.style.left=c.x+"px";a.style.top=c.y+"px";a.style.color="#fff";a.style.fontSize=FZ.GameDefs.STATS_FONT_SIZE+"px";a.style.fontFamily="Arial";a.style.lineHeight=c.h+"px";a.style.textAlign="center";a.innerHTML="";this.m_label_list.push(a);this.m_main_div.appendChild(a);}},setLabelContext:function(){var f=0;var b=null;var e=0;var a=0;var d=0;var g="";var c=0;if(0!==(FZ.GameBase.SaveObject.m_win_times+FZ.GameBase.SaveObject.m_lose_times)){c=Math.floor((FZ.GameBase.SaveObject.m_win_times*100)/(FZ.GameBase.SaveObject.m_win_times+FZ.GameBase.SaveObject.m_lose_times));}e=Math.floor(FZ.GameBase.SaveObject.m_played_time/3600);a=Math.floor(FZ.GameBase.SaveObject.m_played_time/60)%60;d=FZ.GameBase.SaveObject.m_played_time%60;b=this.m_label_list[this.LABEL_BEST_INDEX];f=FZ.GameBase.SaveObject.m_best_score;b.innerHTML=""+f;b=this.m_label_list[this.LABEL_CLEARED_INDEX];f=FZ.GameBase.SaveObject.m_win_times;b.innerHTML=""+f;b=this.m_label_list[this.LABEL_NOT_CLEARED_INDEX];f=FZ.GameBase.SaveObject.m_lose_times;b.innerHTML=""+f;b=this.m_label_list[this.LABEL_TIME_PLAYED_INDEX];g="H:"+e+",M:"+a+",S:"+d;b.innerHTML=""+g;b=this.m_label_list[this.LABEL_WIN_INDEX];g=c+"%";b.innerHTML=""+g;},postProcess:function(){this.fade_out(2000,0,0);},buttonClick:function(a){var b=null;if(this.m_btn_list[this.BTN_RESET_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_RESET);}else{if(this.m_btn_list[this.BTN_RETURN_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_GAME_IN);}}}},FZ.BaseState))();FZ.Game.AchievementState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_ACHIEVEMENT,CUR_UI_DEFS:["GAME_BG","CUBE_MENU_CUP1_LIGHT","CUBE_MENU_CUP2_LIGHT","CUBE_MENU_CUP3","CUBE_MENU_CUP4_LIGHT"],BTN_RETURN_INDEX:0,CUR_BTN_DEFS:[["BTN_MENU_RETURN","BTN_MENU_RETURN_LIGHT"]],m_load_ui:false,preProcess:function(){var b=this;var c=0;var d=null;var e=null;var f=null;var a=null;if(!this.m_load_ui){this.createUIs(this.CUR_UI_DEFS);this.createBtns(this.CUR_BTN_DEFS,true);FZ.DivManager.addChild(this.m_main_div);this.m_load_ui=true;}else{}this.resetTranslate(0);setTimeout(function(){b.fade_in.call(b,2000,1);},10);},postProcess:function(){this.fade_out(2000,0,0);},buttonClick:function(a){var b=null;if(this.m_btn_list[this.BTN_RESET_INDEX]===a){}else{if(this.m_btn_list[this.BTN_RETURN_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_GAME_IN);}}}},FZ.BaseState))();FZ.Game.ResetState=new (FZ.newClass({StateName:FZ.StateDefs.GAME_STATE_RESET,CUR_UI_DEFS:["GAME_BG","CUBE_MENU_RESET"],BTN_YES_INDEX:0,BTN_NO_INDEX:1,CUR_BTN_DEFS:[["BTN_MENU_YES","BTN_MENU_YES_LIGHT"],["BTN_MENU_NO","BTN_MENU_NO_LIGHT"]],STR_RECT:[162,184,138,36],m_last_score_div:null,m_load_ui:false,preProcess:function(g,f,d){var c=this;var e=0;var a=null;var b=null;var h=null;var i=null;if(!this.m_load_ui){this.createUIs(this.CUR_UI_DEFS);this.createBtns(this.CUR_BTN_DEFS,true);FZ.DivManager.addChild(this.m_main_div);this.m_load_ui=true;}else{}this.resetTranslate(0);setTimeout(function(){c.fade_in.call(c,2000,1);},10);},postProcess:function(){this.fade_out(2000,0,0);},clearRecord:function(){FZ.GameBase.SaveObject.bestScore=0;FZ.GameBase.SaveObject.reverse=0;},buttonClick:function(a){var b=null;if(this.m_btn_list[this.BTN_YES_INDEX]===a){this.clearRecord();FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_STATS);}else{if(this.m_btn_list[this.BTN_NO_INDEX]===a){FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_STATS);}}}},FZ.BaseState))();(function(){var f=false;var b=null;var i=null;var d=null;FZ.GameBase.MOBILE_IPAD=10;FZ.GameBase.MOBILE_IPHONE=20;FZ.GameBase.Width=700;FZ.GameBase.Height=500;FZ.GameBase.Name="AquaBubble";FZ.TARGET_DEF={};FZ.TARGET_DEF.PC="pc";FZ.TARGET_DEF.MOBILE="mobile";FZ.TARGET_DEF.IPHONE="iphone";FZ.TARGET_DEF.IPAD="ipad";FZ.TARGET_DEF.ANDRIOD="Android";FZ.TargetPort=FZ.TARGET_DEF.PC;FZ.TargetMobile=FZ.TARGET_DEF.IPHONE;FZ.EVENT_DEF={};FZ.EVENT_DEF.M_OVER="mouseover";FZ.EVENT_DEF.M_OUT="mouseout";FZ.EVENT_DEF.M_MOVE="mousemove";FZ.EVENT_DEF.M_CLICK="click";FZ.EVENT_DEF.T_START="touchstart";FZ.EVENT_DEF.T_MOVE="touchmove";FZ.EVENT_DEF.T_END="touchend";FZ.cheatCode=FZ.GameDefs.CHEAT_MODE_NONE;FZ.curGameScore=0;FZ.ArrayIndexof=function(j,l){var k=0;for(k=0;k<j.length;k++){if(l===j[k]){return k;}}return -1;};var c=function(){var j=null;if(f){return true;}j=FZ.ResourceManager.ResourceLib.safe_zone;if(!j){return false;}b=FZ.GetImageInfoByName("safe_zone");i.style.backgroundRepeat="no-repeat";i.style.backgroundImage="url(res/images/"+b.fileURL+")";i.style.backgroundColor="#fff";f=true;return true;};var h=function(){if(!c()){a();return;}if((90===window.orientation)||(-90===window.orientation)){d.style.display="none";i.style.display="block";}else{if(0===window.orientation){d.style.display="block";i.style.display="none";}}a();};var a=function(){var k=0;var j=0;if(FZ.TARGET_DEF.IPAD===FZ.TargetMobile){j=20;}else{if(FZ.TARGET_DEF.IPHONE===FZ.TargetMobile){j=20;}else{if(FZ.TARGET_DEF.ANDROID===FZ.TargetMobile){j=1;}}}setTimeout(function(){window.scrollTo(k,j);},1000);};var e=function(j){j.stopPropagation();j.preventDefault();return false;};var g=function(){var l=null;var k=null;var j=false;j=FZ.GameBase.loadGame();if(!j){FZ.GameBase.SaveObject.mute=false;FZ.GameBase.SaveObject.bestScore=0;FZ.GameBase.SaveObject.reverse=0;FZ.GameBase.saveGame();}d=FZ.$("mainDiv");i=FZ.$("orientationDiv");FZ.GameBase.animDiv=FZ.$("animDiv");i.style.display="none";if(/(iPhone|iPad|iPod|Android)/i.test(window.navigator.appVersion)){FZ.TargetPort=FZ.TARGET_DEF.MOBILE;FZ.TargetMobile=FZ.TARGET_DEF.IPHONE;if(-1!==navigator.userAgent.indexOf("iPad")){FZ.TargetMobile=FZ.TARGET_DEF.IPAD;}else{if(-1!==navigator.userAgent.indexOf("Android")){FZ.TargetMobile=FZ.TARGET_DEF.ANDROID;}}}l=document.createElement("meta");k=document.getElementsByTagName("head");if(FZ.TARGET_DEF.IPAD===FZ.TargetMobile){l.setAttribute("name","viewport");l.setAttribute("content","width=320; initial-scale=2.2; maximum-scale=2.2; user-scalable=no;");k[0].appendChild(l);}else{l.setAttribute("name","viewport");l.setAttribute("content","width=320; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;");k[0].appendChild(l);}FZ.DivManager.init();FZ.DivManager.setParent(d);FZ.DivManager.setSize(FZ.GameDefs.SCREEN_W,FZ.GameDefs.SCREEN_H);FZ.DivManager.setOffset(d.offsetLeft,d.offsetTop);FZ.GameBase.switchToState(FZ.StateDefs.GAME_STATE_PRELOADING);if(FZ.TARGET_DEF.MOBILE===FZ.TargetPort){window.onscroll=a;window.addEventListener("orientationchange",h,false);}document.addEventListener("touchstart",e,false);a();h();};FZ.GameBase.ArrayIndexof=function(j,l){var k=0;for(k=0;k<j.length;k++){if(l===j[k]){return k;}}return -1;};window.addEventListener("load",g,false);FZ.EventHandler=function(m,l,j,k){if(!l){return;}switch(j){case FZ.EVENT_DEF.M_OVER:l.addEventListener(FZ.EVENT_DEF.M_OVER,m.m_call_mOver=function(n){k.call(m,n);},false);break;case FZ.EVENT_DEF.M_OUT:l.addEventListener(FZ.EVENT_DEF.M_OUT,m.m_call_mOut=function(n){k.call(m,n);},false);break;case FZ.EVENT_DEF.M_MOVE:l.addEventListener(FZ.EVENT_DEF.M_MOVE,m.m_call_mMove=function(n){k.call(m,n);},false);break;case FZ.EVENT_DEF.M_CLICK:l.addEventListener(FZ.EVENT_DEF.M_CLICK,m.m_call_mClick=function(n){k.call(m,n);},false);break;case FZ.EVENT_DEF.T_START:l.addEventListener(FZ.EVENT_DEF.T_START,m.m_call_tStart=function(n){k.call(m,n);},false);break;case FZ.EVENT_DEF.T_MOVE:l.addEventListener(FZ.EVENT_DEF.T_MOVE,m.m_call_tMove=function(n){k.call(m,n);},false);break;case FZ.EVENT_DEF.T_END:l.addEventListener(FZ.EVENT_DEF.T_END,m.m_call_tEnd=function(n){k.call(m,n);},false);break;default:break;}};FZ.EventRemove=function(m,l,j,k){if((!l)||(!k)){return;}switch(j){case FZ.EVENT_DEF.M_OVER:l.removeEventListener(FZ.EVENT_DEF.M_OVER,k,false);m.m_call_mOver=null;break;case FZ.EVENT_DEF.M_OUT:l.removeEventListener(FZ.EVENT_DEF.M_OUT,k,false);m.m_call_mOut=null;break;case FZ.EVENT_DEF.M_MOVE:l.removeEventListener(FZ.EVENT_DEF.M_MOVE,k,false);m.m_call_mMove=null;break;case FZ.EVENT_DEF.M_CLICK:l.removeEventListener(FZ.EVENT_DEF.M_CLICK,k,false);m.m_call_mClick=null;break;case FZ.EVENT_DEF.T_START:l.removeEventListener(FZ.EVENT_DEF.T_START,k,false);m.m_call_tStart=null;break;case FZ.EVENT_DEF.T_MOVE:l.removeEventListener(FZ.EVENT_DEF.T_MOVE,k,false);m.m_call_tMove=null;break;case FZ.EVENT_DEF.T_END:l.removeEventListener(FZ.EVENT_DEF.T_END,k,false);m.m_call_tEnd=null;break;default:break;}};})();